import{r as u,j as e,g as ee,a6 as se,c as $,m as ke,$ as Pe,a2 as $e,v as Se,R as T,b as D,I as J}from"./index-02b2945e.js";import{I as Me}from"./ImageSearch-6df1d0d1.js";import{s as k,S as Q}from"./ScorePie-ef00e97d.js";import{G as te}from"./Graph-d1b46b16.js";import{L as X}from"./Label-2d9d5124.js";import{c as S}from"./colours.module-29b309d0.js";import{u as Y,a as De}from"./profiler-25e786d5.js";import{l as ae}from"./localiser-c0c9a31b.js";import{c as I,I as O}from"./IconButton-02bc1303.js";import{g as re}from"./graphColours-c6ae9e73.js";import{c as V,a as P,u as U}from"./configState-6be3aa1d.js";import{u as Ie,g as Te,a as ze}from"./Portal-a2b43acb.js";import{T as Ve,r as Ge,g as ie}from"./useSlot-050d423d.js";import{e as We}from"./createSimplePaletteValueFilter-b2e05aa4.js";import{d as Oe}from"./debounce-517eeb3c.js";import{a as Ue,R as B}from"./RadioGroup-2c88d32f.js";import{C as Be}from"./Close-50ef3ec2.js";import{I as He}from"./ImageGrid-ff60fbdd.js";import{R as Ae}from"./Refresh-d5d9edd3.js";import{L as Fe}from"./LocalFireDepartment-2907a69f.js";import{S as oe}from"./Spacer-de9dcc41.js";import{I as A}from"./Item-79c80338.js";import{I as qe}from"./IconMenuInline-1e64afd8.js";import{R as Ke}from"./RecommendationsHeatmap-cbbc4619.js";import{u as Xe}from"./recommender-9b8a9795.js";function Ye(t,a,n){const s=a.getBoundingClientRect(),i=n&&n.getBoundingClientRect(),l=ze(a);let r;if(a.fakeTransform)r=a.fakeTransform;else{const c=l.getComputedStyle(a);r=c.getPropertyValue("-webkit-transform")||c.getPropertyValue("transform")}let d=0,o=0;if(r&&r!=="none"&&typeof r=="string"){const c=r.split("(")[1].split(")")[0].split(",");d=parseInt(c[4],10),o=parseInt(c[5],10)}return t==="left"?i?`translateX(${i.right+d-s.left}px)`:`translateX(${l.innerWidth+d-s.left}px)`:t==="right"?i?`translateX(-${s.right-i.left-d}px)`:`translateX(-${s.left+s.width-d}px)`:t==="up"?i?`translateY(${i.bottom+o-s.top}px)`:`translateY(${l.innerHeight+o-s.top}px)`:i?`translateY(-${s.top-i.top+s.height-o}px)`:`translateY(-${s.top+s.height-o}px)`}function Ze(t){return typeof t=="function"?t():t}function F(t,a,n){const s=Ze(n),i=Ye(t,a,s);i&&(a.style.webkitTransform=i,a.style.transform=i)}const Je=u.forwardRef(function(a,n){const s=Ie(),i={enter:s.transitions.easing.easeOut,exit:s.transitions.easing.sharp},l={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen},{addEndListener:r,appear:d=!0,children:o,container:c,direction:m="down",easing:p=i,in:b,onEnter:w,onEntered:_,onEntering:g,onExit:y,onExited:j,onExiting:h,style:C,timeout:M=l,TransitionComponent:v=Ve,...G}=a,R=u.useRef(null),Z=We(Te(o),R,n),f=x=>L=>{x&&(L===void 0?x(R.current):x(R.current,L))},N=f((x,L)=>{F(m,x,c),Ge(x),w&&w(x,L)}),ye=f((x,L)=>{const H=ie({timeout:M,style:C,easing:p},{mode:"enter"});x.style.webkitTransition=s.transitions.create("-webkit-transform",{...H}),x.style.transition=s.transitions.create("transform",{...H}),x.style.webkitTransform="none",x.style.transform="none",g&&g(x,L)}),ve=f(_),Ee=f(h),Ne=f(x=>{const L=ie({timeout:M,style:C,easing:p},{mode:"exit"});x.style.webkitTransition=s.transitions.create("-webkit-transform",L),x.style.transition=s.transitions.create("transform",L),F(m,x,c),y&&y(x)}),Le=f(x=>{x.style.webkitTransition="",x.style.transition="",j&&j(x)}),Re=x=>{r&&r(R.current,x)},ne=u.useCallback(()=>{R.current&&F(m,R.current,c)},[m,c]);return u.useEffect(()=>{if(b||m==="down"||m==="right")return;const x=Oe(()=>{R.current&&F(m,R.current,c)}),L=ze(R.current);return L.addEventListener("resize",x),()=>{x.clear(),L.removeEventListener("resize",x)}},[m,b,c]),u.useEffect(()=>{b||ne()},[b,ne]),e.jsx(v,{nodeRef:R,onEnter:N,onEntered:ve,onEntering:ye,onExit:Ne,onExited:Le,onExiting:Ee,addEndListener:Re,appear:d,in:b,timeout:M,...G,children:(x,{ownerState:L,...H})=>u.cloneElement(o,{ref:Z,style:{visibility:x==="exited"&&!b?"hidden":void 0,...C,...o.props.style},...H})})}),Qe=Je,et="#5f7377",tt="#e8f0fe",nt="#444",st="#008297",at="rgb(174, 37, 174)",rt="#dfe5e8",it="_container_1lljw_3",ot="_outerContainer_1lljw_14",ct="_number_1lljw_25",lt="_buttonList_1lljw_36",dt="_buttonBar_1lljw_43",mt="_infoBar_1lljw_54",q={backgroundDark:et,bgSubdued1:tt,textDark:nt,primary:st,secondary:at,workspaceBg:rt,container:it,outerContainer:ot,number:ct,buttonList:lt,buttonBar:dt,infoBar:mt},ce={},le=5,ut=u.memo(function({disabled:a,node:n}){var d,o,c,m,p;const s=ee(),i=n.size,l=((d=n.data)==null?void 0:d.image)||"",r=(o=n.data)==null?void 0:o.name;return e.jsxs("g",{className:a?ce.disabledGroup:ce.group,children:[e.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r:i,fill:l.length>0?"white":((c=n.data)==null?void 0:c.colour)||"#5f7377",stroke:((m=n.data)==null?void 0:m.colour)||"#5f7377",strokeWidth:le}),l.length>0&&e.jsx("image",{x:-i,y:-i,width:i*2,height:i*2,href:s.getContentData(l,!0),preserveAspectRatio:"none",clipPath:`circle(${i-le}px)`}),r&&e.jsx(X,{label:r,x:0,y:i+30,scale:r.length<20?2.5:2,padding:5,fill:((p=n.data)==null?void 0:p.colour)||"#5f7377",color:"white"})]})}),ft=20,gt=5;function ht({userId:t,pairedId:a,contentId:n}){const s=Y(t),i=Y(a),l=De(s),[r,d]=u.useState([]),[o,c]=u.useState([]);return u.useEffect(()=>{const m=l.reduce((h,C)=>Math.min(h,C.weight),1),b=l.reduce((h,C)=>Math.max(h,C.weight),0)-m,w=i.affinities.contents.contents.reduce((h,C)=>Math.min(h,C.weight),1),g=i.affinities.contents.contents.reduce((h,C)=>Math.max(h,C.weight),0)-w,y=[...l.filter(h=>h.id!==a).map(h=>({id:h.id,size:30,data:{colour:S.backgroundDark}})),...i.affinities.contents.contents.filter(h=>h.id!==n).map(h=>({id:h.id,size:40,data:{image:h.id,colour:S.primary}})),{id:t,size:30,fx:-300,fy:-100,data:{name:s.name,colour:S.secondary}},{id:a,size:30,fx:-50,fy:0,data:{name:i.name,colour:S.secondary}},{id:n,size:80,fx:220,fy:100,data:{image:n,colour:S.secondary}}];d(y);const j=[...l.map(h=>({source:t,target:h.id,strength:(h.weight-m)/b,actualStrength:h.weight})),...i.affinities.contents.contents.map(h=>({source:a,target:h.id,strength:(h.weight-w)/g,actualStrength:h.weight}))];c(j)},[l,s,t,a,i,n]),e.jsx(te,{links:o,nodes:r,linkScale:1,defaultLinkStyle:{opacity:m=>m.target.fx!==void 0?.6:.1,width:m=>gt+Math.floor(m.strength*ft),colour:m=>m.target.fx!==void 0?S.secondary:"#444"},charge:.3,showLines:!0,zoom:1,center:[0,0],disableControls:!0,disableCenter:!0,children:r.map(m=>e.jsx(ut,{id:m.id,node:m,onResize:()=>{}},m.id))})}const de={},me=5,pt=u.memo(function({disabled:a,node:n,id:s,onResize:i}){var c,m,p,b,w,_,g;const l=ee(),r=n.size,d=((c=n.data)==null?void 0:c.image)||"",o=(m=n.data)==null?void 0:m.name;return e.jsxs("g",{className:a?de.disabledGroup:de.group,children:[!se(s)&&e.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r,fill:d.length>0?"white":((p=n.data)==null?void 0:p.colour)||"#5f7377",stroke:((b=n.data)==null?void 0:b.colour)||"#5f7377",strokeWidth:me}),d.length>0&&e.jsx("image",{x:-r,y:-r,width:r*2,height:r*2,href:l.getContentData(d,!0),preserveAspectRatio:"none",clipPath:`circle(${r-me}px)`}),o&&e.jsx(X,{label:o,x:0,y:r+30,scale:o.length<20?2.5:2,padding:5,fill:((w=n.data)==null?void 0:w.colour)||"#5f7377",color:"white"}),se(s)&&e.jsx(X,{label:((_=n.data)==null?void 0:_.label)||"NoLabel",x:0,y:0,scale:2.5,padding:5,fill:((g=n.data)==null?void 0:g.colour)||"#5f7377",color:"white",onResize:y=>i(s,Math.ceil(y))})]})}),xt=20,bt=5,K=.1;function wt({userId:t,topic:a,contentId:n}){const{i18n:s}=$(),i=Y(t),[l,r]=u.useReducer(g=>g+1,0),[d,o]=u.useState([]),[c,m]=u.useState([]),p=u.useRef(new Map),{graph:b,content:w}=ke(),_=u.useCallback((g,y)=>{const j=p.current.get(g);p.current.set(g,y),j!==y&&r()},[]);return u.useEffect(()=>{const g=i.affinities.topics.topics.slice(0,5),y=g.reduce((f,N)=>Math.min(f,N.weight),1e3),h=g.reduce((f,N)=>Math.max(f,N.weight),0)-y,C=b.getRelated("content",Pe(b,a)).map(f=>{var N;return{id:f.id,weight:((N=w.getContentStats(f.id))==null?void 0:N.engagement)||0}});C.sort((f,N)=>N.weight-f.weight),C.splice(5);const M=C.reduce((f,N)=>Math.min(f,N.weight),1),G=C.reduce((f,N)=>Math.max(f,N.weight),0)-M,R=[...g.filter(f=>f.label!==a).map(f=>({id:`topic:${f.label}`,size:p.current.get(`topic:${f.label}`)||30,data:{colour:S.backgroundDark,label:`#${ae.getLocalisedLabel(f.label,s.language)}`}})),...C.filter(f=>f.id!==n).map(f=>({id:f.id,size:30,data:{colour:S.backgroundDark,image:f.id}})),{id:t,size:30,fx:-180,fy:100,data:{name:i.name,colour:S.secondary}},{id:`topic:${a}`,size:p.current.get(`topic:${a}`)||30,fx:20,fy:0,data:{label:`#${ae.getLocalisedLabel(a,s.language)}`,colour:S.secondary}},{id:n,size:80,fx:280,fy:-150,data:{image:n,colour:S.secondary}}];o(R);const Z=[...g.filter(f=>f.label!==a).map(f=>({source:t,target:`topic:${f.label}`,strength:(f.weight-y)/h*K+(1-K),actualStrength:f.weight})),{source:`topic:${a}`,target:n,strength:.5,actualStrength:.5},{target:`topic:${a}`,source:t,strength:.5,actualStrength:.5},...C.filter(f=>f.id!==n).map(f=>({source:`topic:${a}`,target:f.id,strength:G>0?(f.weight-M)/G*K+(1-K):.5,actualStrength:f.weight||.5}))];m(Z)},[i,t,n,a,l,w,b,s]),e.jsx(te,{links:c,nodes:d,linkScale:10,defaultLinkStyle:{opacity:g=>g.target.fx!==void 0?.6:.1,width:g=>bt+Math.floor(g.strength*xt),colour:g=>g.target.fx!==void 0?S.secondary:"#444"},charge:.1,showLines:!0,zoom:1,center:[0,0],disableControls:!0,disableCenter:!1,children:d.map(g=>e.jsx(pt,{id:g.id,node:g,onResize:_},g.id))})}const ue={},fe=5,jt=u.memo(function({disabled:a,node:n}){var d,o,c,m,p;const s=ee(),i=n.size,l=((d=n.data)==null?void 0:d.image)||"",r=(o=n.data)==null?void 0:o.name;return e.jsxs("g",{className:a?ue.disabledGroup:ue.group,children:[e.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r:i,fill:(l.length>0?"white":(c=n.data)==null?void 0:c.colour)||"#5f7377",stroke:((m=n.data)==null?void 0:m.colour)||"#5f7377",strokeWidth:fe}),l.length>0&&e.jsx("image",{x:-i,y:-i,width:i*2,height:i*2,href:s.getContentData(l,!0),preserveAspectRatio:"none",clipPath:`circle(${i-fe}px)`}),r&&e.jsx(X,{label:r,x:0,y:i+30,scale:r.length<20?2.5:2,padding:5,fill:((p=n.data)==null?void 0:p.colour)||"#5f7377",color:"white"})]})}),St=20,zt=5;function Ct({userId:t,originId:a,contentId:n}){const s=Y(t),[i,l]=u.useState([]),[r,d]=u.useState([]),o=$e();return u.useEffect(()=>{const c=o.getRelated("coengaged",a,{count:8}),m=o.getEdgeWeights("engaged",t,a)[0]||0,p=o.getEdgeWeights("coengaged",a,n)[0]||0,b=c.reduce((j,h)=>Math.min(j,h.weight),Math.min(m,p)),_=c.reduce((j,h)=>Math.max(j,h.weight),Math.max(m,p))-b,g=[...c.filter(j=>j.id!==n).map(j=>({id:j.id,size:40,data:{colour:S.backgroundDark,image:j.id}})),{id:t,size:30,fx:-300,fy:-100,data:{name:s.name,colour:S.secondary}},{id:a,size:80,fx:-50,fy:0,data:{image:a,colour:S.secondary}},{id:n,size:80,fx:220,fy:100,data:{image:n,colour:S.secondary}}];l(g);const y=[...c.filter(j=>j.id!==n).map(j=>({source:a,target:j.id,strength:(j.weight-b)/_,actualStrength:j.weight})),{source:t,target:a,strength:(m-b)/_,actualStrength:m},{source:a,target:n,strength:(p-b)/_,actualStrength:p}];d(y)},[a,n,t,s,o]),e.jsx(te,{links:r,nodes:i,linkScale:1,defaultLinkStyle:{opacity:c=>c.target.fx!==void 0?.6:.1,width:c=>zt+Math.floor(c.strength*St),colour:c=>c.target.fx!==void 0?S.secondary:"#444"},charge:.3,showLines:!0,zoom:1,center:[0,0],disableControls:!0,disableCenter:!0,children:i.map(c=>e.jsx(jt,{id:c.id,node:c,onResize:()=>{}},c.id))})}function _t(t,a,n){var i;let s;switch(a.candidateOrigin){case"topic_affinity":s=n("recommendations.labels.topicCandidate",{topic:a.topic||""});break;case"random":s=n("recommendations.labels.random");break;case"popular":s=n("recommendations.labels.popularCandidate");break;case"coengagement":s=n("recommendations.labels.coengagedCandidate");break;case"similar_user":s=n("recommendations.labels.similarUserCandidate",{userName:a.similarUser&&((i=t.getUserData(a.similarUser))==null?void 0:i.name)||""});break;default:s=""}return s}function yt({item:t,userId:a}){const{t:n}=$(),s=Se();return e.jsxs("li",{"data-testid":"candidate-item",children:[e.jsxs("div",{className:k.listIcon,children:[e.jsx(Me,{fontSize:"large"}),e.jsx("h2",{children:n("recommendations.titles.candidateOrigin")})]}),e.jsxs("div",{className:k.listColumn,children:[_t(s,t,n),t.candidateOrigin==="similar_user"&&e.jsx("div",{className:k.miniGraphBox,children:e.jsx(ht,{userId:a,pairedId:t.similarUser||"user:none",contentId:t.contentId})}),t.candidateOrigin==="topic_affinity"&&e.jsx("div",{className:k.miniGraphBox,children:e.jsx(wt,{userId:a,topic:t.topic||"",contentId:t.contentId})}),t.candidateOrigin==="coengagement"&&e.jsx("div",{className:k.miniGraphBox,children:e.jsx(Ct,{userId:a,originId:t.engagedItem||"content:x",contentId:t.contentId})})]})]})}const vt=I(e.jsx("path",{d:"M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2M5 8V7h2v3.82C5.84 10.4 5 9.3 5 8m14 0c0 1.3-.84 2.4-2 2.82V7h2z"}),"EmojiEvents");function Et({item:t}){const{t:a}=$();return e.jsxs("li",{"data-testid":"score-item",children:[e.jsxs("div",{className:k.listIcon,children:[e.jsx(vt,{fontSize:"large"}),e.jsx("h2",{children:a("recommendations.titles.predictedScore")})]}),e.jsx("div",{className:k.listColumn,style:{alignItems:"center"},children:e.jsxs("div",{className:k.scoreList,children:[e.jsx(Q,{value:t.score||0,maxValue:1,label:a("recommendations.labels.score"),showValue:!0,color:S.secondary,size:100,bgColor:S.bgSubdued1}),e.jsx(Q,{value:t.diversity||0,maxValue:1,label:a("recommendations.labels.diversity"),showValue:!0,color:S.primary,size:70,bgColor:S.bgSubdued1})]})})]})}const Nt=I(e.jsx("path",{d:"M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7"}),"Lightbulb"),ge=20,he=60;function Lt({item:t}){const{t:a}=$(),n=Object.keys(t.scores),s=n.map(o=>t.significance[o]||0),i=Math.max(...s),l=Math.min(...s),r=i-l,d=n.map(o=>({name:o,score:t.features[o]||0,significance:r>0?((t.significance[o]||0)-l)/r:t.significance[o]||0})).filter(o=>o.score>0&&o.significance>0);return d.sort((o,c)=>c.significance-o.significance),e.jsxs("li",{"data-testid":"explain-item",children:[e.jsxs("div",{className:k.listIcon,children:[e.jsx(Nt,{fontSize:"large"}),e.jsx("h2",{children:a("recommendations.titles.explainScore")})]}),e.jsx("div",{className:k.listColumn,children:d.map((o,c)=>o.score>0?e.jsxs("div",{className:k.scoreRow,children:[e.jsx(Q,{value:o.score||0,maxValue:1,showValue:!0,color:re[c%re.length],bgColor:S.bgSubdued1,size:r>0?o.significance*ge+he:he+ge/2}),e.jsx("div",{children:a(`recommendations.features.${o.name}`)})]},o.name):null)})]})}function Rt({userId:t,recommendation:a,hideExplain:n,hideCandidate:s,hideScores:i}){return e.jsx("div",{children:e.jsxs("ul",{className:k.tableList,children:[!s&&e.jsx(yt,{item:a,userId:t}),!i&&e.jsx(Et,{item:a}),!n&&e.jsx(Lt,{item:a})]})})}const kt="#e8f0fe",Pt="#444",$t="#008297",Mt="rgb(174, 37, 174)",Dt="#dfe5e8",It="_wizard_yzri2_3",Tt="_wizardClosed_yzri2_13 _wizard_yzri2_3",Vt="_plainwizard_yzri2_21 _wizard_yzri2_3",Gt="_plainwizardClosed_yzri2_27 _plainwizard_yzri2_21 _wizard_yzri2_3",Wt="_wizardStartPage_yzri2_39",Ot="_wizardPage_yzri2_43",Ut="_wizardControls_yzri2_51",Bt="_fadein_yzri2_1",Ht="_wizardLabelContainer_yzri2_71",At="_wizardLabelDisabled_yzri2_81 _wizardLabelContainer_yzri2_71",Ft="_wizardLabel_yzri2_71",qt="_wizardLabelSelect_yzri2_91 _wizardLabel_yzri2_71",Kt="_wizardLabelDesc_yzri2_96",Xt="_wizardLabelGroup_yzri2_100",z={bgSubdued1:kt,textDark:Pt,primary:$t,secondary:Mt,workspaceBg:Dt,wizard:It,wizardClosed:Tt,plainwizard:Vt,plainwizardClosed:Gt,wizardStartPage:Wt,wizardPage:Ot,wizardControls:Ut,fadein:Bt,wizardLabelContainer:Ht,wizardLabelDisabled:At,wizardLabel:Ft,wizardLabelSelect:qt,wizardLabelDesc:Kt,wizardLabelGroup:Xt},Yt="#5f7377",Zt="#444",Jt="_container_1bj1q_3",Qt="_page_1bj1q_9",en="_slideControls_1bj1q_15",tn="_stepper_1bj1q_21",nn="_step_1bj1q_21",sn="_activeStep_1bj1q_35 _step_1bj1q_21",an="_inactiveStep_1bj1q_40 _step_1bj1q_21",W={backgroundDark:Yt,textDark:Zt,container:Jt,page:Qt,slideControls:en,stepper:tn,step:nn,activeStep:sn,inactiveStep:an};function rn(t,a,n){let s="left";return t===n?n<a?s="right":s="left":n<a?s="left":s="right",s}function on({page:t,children:a,onHeight:n,controls:s}){const i=u.useRef(-1),[l,r]=u.useState(-1),d=u.useRef(null),o=u.useRef(null);return u.useEffect(()=>{const c=t;return r(t),()=>{i.current=c}},[t]),e.jsxs("div",{ref:d,className:W.container,children:[Array.isArray(a)?a.map((c,m)=>e.jsx(Qe,{direction:rn(m,t,i.current),in:l===m,mountOnEnter:!0,unmountOnExit:!0,container:d.current,onEnter:p=>{var b;n&&n(p.clientHeight+(((b=o.current)==null?void 0:b.clientHeight)||0))},children:e.jsx("div",{className:W.page,children:c})},m)):a,s&&e.jsx("div",{className:W.slideControls,ref:o,children:s})]})}function Ce(t){return t.taste>0||t.coengaged>0||t.similarUsers>0}function _e(t){return t.random>0||t.popular>0}function cn(t){return!_e(t)&&Ce(t)}function ln(t){return _e(t)&&!Ce(t)}function dn(t){return cn(t)?"personal":ln(t)?"nonpersonal":"both"}function mn(t){return!t.noTasteScore||!t.noCoengagementScore||!t.noSharingScore||!t.noCommentingScore||!t.noFollowingScore||!t.noViewingScore||!t.noReactionScore}function un(t){return mn(t)?t!=null&&t.noPopularity?"profile":"all":t!=null&&t.noPopularity?"random":"noprofile"}function E({label:t,description:a,value:n,color:s,disabled:i,selected:l}){return e.jsxs("label",{className:i?z.wizardLabelDisabled:z.wizardLabelContainer,style:{borderColor:s||void 0},children:[e.jsx(Ue,{value:n,disabled:i,inputProps:{"data-testid":`${n}-option`}}),e.jsxs("div",{className:z.wizardLabelGroup,children:[e.jsx("span",{className:l?z.wizardLabelSelect:z.wizardLabel,children:t}),e.jsx("span",{className:z.wizardLabelDesc,children:a})]})]})}const pe={both:{random:2,similarUsers:2,taste:2,coengaged:2,popular:2},personal:{random:0,similarUsers:2,taste:2,coengaged:2,popular:0},nonpersonal:{random:2,similarUsers:0,taste:0,coengaged:0,popular:2}};function fn({id:t,changePage:a}){const{t:n}=$(),s=T(t?V(t):P),i=D(U(t||"user:none")),l=D(P),r=dn(s.recommendations);return u.useEffect(()=>{s.showCandidateRefinementWizard?r==="personal"?a(2):r==="nonpersonal"?a(3):s.showScoringWizard?a(4):s.showDiversityWizard?a(5):a(0):s.showScoringWizard?a(4):s.showDiversityWizard?a(5):a(0)},[r,a,s]),e.jsxs("section",{className:z.wizardPage,"data-testid":"recom-candidate-options",children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.candidateDiscovery")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(B,{sx:{gap:"0.5rem"},"aria-label":"",defaultValue:"both",name:"radio-buttons-group",value:r,onChange:(d,o)=>{t?i({recommendations:{...s.recommendations,...pe[o]}}):l(c=>({...c,recommendations:{...c.recommendations,...pe[o]}}))},children:[e.jsx(E,{selected:r==="personal",value:"personal",label:n("recommendations.labels.candidatePersonal"),description:n("recommendations.descriptions.candidatePersonal")}),e.jsx(E,{selected:r==="nonpersonal",value:"nonpersonal",label:n("recommendations.labels.candidateNonPersonal"),description:n("recommendations.descriptions.candidateNonPersonal")}),e.jsx(E,{selected:r==="both",value:"both",label:n("recommendations.labels.candidatePersonalAndNon"),description:n("recommendations.descriptions.candidatePersonalAndNon")})]})})]})}const xe={noprofile:{noTasteScore:!0,noSharingScore:!0,noFollowingScore:!0,noReactionScore:!0,noViewingScore:!0,noCoengagementScore:!0,noCommentingScore:!0,noPopularity:!1},profile:{noTasteScore:!1,noSharingScore:!1,noFollowingScore:!1,noReactionScore:!1,noViewingScore:!1,noCoengagementScore:!1,noCommentingScore:!1,noPopularity:!0},random:{noTasteScore:!0,noSharingScore:!0,noFollowingScore:!0,noReactionScore:!0,noViewingScore:!0,noCoengagementScore:!0,noCommentingScore:!0,noPopularity:!0},all:{noTasteScore:!1,noSharingScore:!1,noFollowingScore:!1,noReactionScore:!1,noViewingScore:!1,noCoengagementScore:!1,noCommentingScore:!1,noPopularity:!1}};function gn({id:t,changePage:a}){const{t:n}=$(),s=T(t?V(t):P),i=D(U(t||"user:none")),l=D(P),r=un(s.recommendations);return u.useEffect(()=>{s.showDiversityWizard?a(5):a(0)},[s,r,a]),e.jsxs("section",{className:z.wizardPage,children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.scoringOptions")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(B,{sx:{gap:"0.5rem"},"aria-label":"",defaultValue:"both",name:"radio-buttons-group",value:r,onChange:(d,o)=>{t?i({recommendations:{...s.recommendations,...xe[o]}}):l(c=>({...c,recommendations:{...c.recommendations,...xe[o]}}))},children:[e.jsx(E,{selected:r==="profile",value:"profile",label:n("recommendations.labels.scoringPredict"),description:n("recommendations.descriptions.scoringPredict")}),e.jsx(E,{selected:r==="noprofile",value:"noprofile",label:n("recommendations.labels.scoringGeneral"),description:n("recommendations.descriptions.scoringGeneral")}),e.jsx(E,{selected:r==="random",value:"random",label:n("recommendations.labels.scoringRandom"),description:n("recommendations.descriptions.scoringRandom")}),e.jsx(E,{selected:r==="all",value:"all",label:n("recommendations.labels.scoringAll"),description:n("recommendations.descriptions.scoringAll")})]})})]})}const be={all:{random:0,similarUsers:2,taste:2,coengaged:2,popular:0},taste:{random:0,similarUsers:0,taste:4,coengaged:0,popular:0},users:{random:0,similarUsers:4,taste:0,coengaged:0,popular:0},coengaged:{random:0,similarUsers:0,taste:0,coengaged:4,popular:0}};function hn(t){return t.taste>0&&t.coengaged>0&&t.similarUsers>0?"all":t.taste>0?"taste":t.similarUsers>0?"users":t.coengaged>0?"coengaged":"all"}function pn({id:t,changePage:a}){const{t:n}=$(),s=T(t?V(t):P),i=D(U(t||"user:none")),l=D(P);return u.useEffect(()=>{s.showScoringWizard?a(4):s.showDiversityWizard?a(5):a(0)},[s,a]),e.jsxs("section",{className:z.wizardPage,children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.candidatesPersonal")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(B,{"aria-label":"",sx:{gap:"0.5rem"},defaultValue:"image",name:"radio-buttons-group",value:hn(s.recommendations),onChange:(r,d)=>{t?i({recommendations:{...s.recommendations,...be[d]}}):l(o=>({...o,recommendations:{...o.recommendations,...be[d]}}))},children:[e.jsx(E,{value:"taste",label:n("recommendations.labels.candidateLabels"),description:n("recommendations.descriptions.candidateLabels")}),e.jsx(E,{value:"users",label:n("recommendations.labels.candidateUsers"),description:n("recommendations.descriptions.candidateUsers")}),e.jsx(E,{value:"coengaged",label:n("recommendations.labels.candidateCoengaged"),description:n("recommendations.descriptions.candidateCoengaged")}),e.jsx(E,{value:"all",label:n("recommendations.labels.candidateAll")})]})})]})}const we={all:{random:2,similarUsers:0,taste:0,coengaged:0,popular:2},random:{random:4,similarUsers:0,taste:0,coengaged:0,popular:0},popular:{random:0,similarUsers:0,taste:0,coengaged:0,popular:2}};function xn(t){return t.random>0&&t.popular>0?"all":t.popular>0?"popular":t.random>0?"random":"all"}function bn({id:t,changePage:a}){const{t:n}=$(),s=T(t?V(t):P),i=D(U(t||"user:none")),l=D(P);return u.useEffect(()=>{s.showScoringWizard?a(4):s.showDiversityWizard?a(5):a(0)},[s,a]),e.jsxs("section",{className:z.wizardPage,children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.candidatesNonPersonal")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(B,{"aria-label":"",defaultValue:"image",sx:{gap:"0.5rem"},name:"radio-buttons-group",value:xn(s.recommendations),onChange:(r,d)=>{t?i({recommendations:{...s.recommendations,...we[d]}}):l(o=>({...o,recommendations:{...o.recommendations,...we[d]}}))},children:[e.jsx(E,{value:"random",label:n("recommendations.labels.candidateRandom"),description:n("recommendations.descriptions.candidateRandom")}),e.jsx(E,{value:"popular",label:n("recommendations.labels.candidatePopular"),description:n("recommendations.descriptions.candidatePopular")}),e.jsx(E,{value:"all",label:n("recommendations.labels.candidateAll")})]})})]})}const wn=I(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos"),jn=I(e.jsx("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"}),"ArrowBackIosNew");function Sn({steps:t,page:a}){const s=u.useMemo(()=>{const i=new Map;return t&&t.forEach((l,r)=>{l.forEach(d=>{i.set(d,r)})}),i},[t]).get(a)||0;return e.jsx("div",{className:W.stepper,children:Array.from({length:t.length},(i,l)=>e.jsx("div",{className:l===s?W.activeStep:W.inactiveStep},l))})}const zn=I(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel");function Cn({id:t,changePage:a}){const{t:n}=$(),s=T(t?V(t):P),i=D(U(t||"user:none")),l=D(P),r=s.recommendations.selection;return u.useEffect(()=>{a(0)},[r,a]),e.jsxs("section",{className:z.wizardPage,children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.diversityOptions")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(B,{sx:{gap:"0.5rem"},"aria-label":"",defaultValue:"both",name:"radio-buttons-group",value:r||"distribution",onChange:(d,o)=>{t?i({recommendations:{...s.recommendations,selection:o}}):l(c=>({...c,recommendations:{...c.recommendations,selection:o}}))},children:[e.jsx(E,{selected:r==="distribution",value:"distribution",label:n("recommendations.labels.selectionProbability"),description:n("recommendations.descriptions.selectionProbability")}),e.jsx(E,{selected:r==="rank",value:"rank",label:n("recommendations.labels.selectionRank"),description:n("recommendations.descriptions.selectionRank")})]})})]})}function _n({id:t,active:a,onClose:n,hideClose:s,variant:i="styled"}){const{t:l}=$(),[r,d]=u.useState(0),[o,c]=u.useState(0),[m,p]=u.useState(1),b=u.useRef([0]),w=T(t?V(t):P);u.useEffect(()=>{a&&(w.showCandidateWizard?d(1):w.showScoringWizard?d(4):w.showDiversityWizard?d(5):d(1))},[a]);const _=g=>{g>r&&b.current.push(r),d(g),g===0&&n()};return e.jsxs("section",{className:i==="styled"?a?z.wizard:z.wizardClosed:a?z.plainwizard:z.plainwizardClosed,style:{height:`${o}px`},"data-testid":"recom-wizard",children:[e.jsxs(on,{page:r,onHeight:c,controls:r>0?e.jsxs("div",{className:z.wizardControls,children:[e.jsx(J,{variant:"outlined",disabled:r<=1,color:"inherit",onClick:()=>_(b.current.pop()||0),startIcon:e.jsx(jn,{}),children:l("recommendations.actions.back")}),e.jsx(Sn,{steps:[[0,1],w.showCandidateRefinementWizard?[2,3]:void 0,w.showScoringWizard?[4]:void 0,w.showDiversityWizard?[5]:void 0].filter(g=>g!==void 0),page:r}),e.jsx(J,{color:"primary",variant:"contained",onClick:()=>_(m),endIcon:m===0?e.jsx(Be,{}):e.jsx(wn,{}),disabled:m<0,"aria-live":"off",children:l(m===0?"recommendations.actions.close":"recommendations.actions.continue")})]}):null,children:[e.jsx("div",{className:z.wizardStartPage}),e.jsx(fn,{id:t,changePage:p}),e.jsx(pn,{id:t,changePage:p}),e.jsx(bn,{id:t,changePage:p}),e.jsx(gn,{id:t,changePage:p}),e.jsx(Cn,{id:t,changePage:p})]}),r>0&&!s&&e.jsx(O,{sx:{position:"absolute",top:"5px",right:"5px"},size:"small",onClick:()=>_(0),"aria-label":l("recommendations.actions.close"),children:e.jsx(zn,{htmlColor:"#444",fontSize:"medium"})})]})}const je=I(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),yn=I(e.jsx("path",{d:"m16.24 11.51 1.57-1.57-3.75-3.75-1.57 1.57-4.14-4.13c-.78-.78-2.05-.78-2.83 0l-1.9 1.9c-.78.78-.78 2.05 0 2.83l4.13 4.13L3 17.25V21h3.75l4.76-4.76 4.13 4.13c.95.95 2.23.6 2.83 0l1.9-1.9c.78-.78.78-2.05 0-2.83zm-7.06-.44L5.04 6.94l1.89-1.9L8.2 6.31 7.02 7.5l1.41 1.41 1.19-1.19 1.45 1.45zm7.88 7.89-4.13-4.13 1.9-1.9 1.45 1.45-1.19 1.19 1.41 1.41 1.19-1.19 1.27 1.27zm3.65-11.92c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.47-.47-1.12-.29-1.41 0l-1.83 1.83 3.75 3.75z"}),"DesignServices"),vn=I(e.jsx("path",{d:"M4 8h4V4H4zm6 12h4v-4h-4zm-6 0h4v-4H4zm0-6h4v-4H4zm6 0h4v-4h-4zm6-10v4h4V4zm-6 4h4V4h-4zm6 6h4v-4h-4zm0 6h4v-4h-4z"}),"Apps"),En=I(e.jsx("path",{d:"M12 4.81V19c-3.31 0-6-2.63-6-5.87 0-1.56.62-3.03 1.75-4.14zM6.35 7.56C4.9 8.99 4 10.96 4 13.13 4 17.48 7.58 21 12 21s8-3.52 8-7.87c0-2.17-.9-4.14-2.35-5.57L12 2z"}),"InvertColors");function Qn({id:t,generate:a,noWizard:n}){const{t:s}=$(),i=Se(),l=t||i.getCurrentUser(),r=T(V(l)),{recommendations:d,more:o}=Xe(9,t,r==null?void 0:r.recommendations),[c,m]=u.useState(),[p,b]=u.useState(!1),[w,_]=u.useState("grid"),[g,y]=u.useReducer(v=>v+1,0),[j,h]=u.useState(!1),C=d.map(v=>({id:v.contentId,weight:Math.max(v.score,.01)}));u.useEffect(()=>{a&&o()},[a,o]);const M=c&&d.find(v=>v.contentId===c);return e.jsx("div",{className:q.outerContainer,children:e.jsxs("div",{className:q.container,tabIndex:0,children:[r.showRecommendationWizard&&!n&&e.jsx(_n,{active:p,onClose:()=>b(!1),id:l}),!r.hideRecommendationMenu&&e.jsxs(qe,{children:[r.showRecommendationWizard&&!n&&e.jsxs(e.Fragment,{children:[e.jsx(J,{onClick:()=>b(!0),variant:"contained",color:"secondary",startIcon:e.jsx(yn,{}),"data-testid":"start-recom-wizard",sx:{marginLeft:"1rem"},disabled:p,children:s("recommendations.actions.change")}),e.jsx("div",{style:{flexGrow:1}}),e.jsx(oe,{})]}),e.jsx(A,{tooltip:s("recommendations.labels.imageGrid"),selected:w==="grid",children:e.jsx(O,{color:"inherit",onClick:()=>_("grid"),"aria-label":s("recommendations.aria.imageGrid"),children:e.jsx(vn,{})})}),e.jsx(A,{tooltip:s("recommendations.labels.heatmap"),selected:w==="heat",children:e.jsx(O,{color:"inherit",onClick:()=>_("heat"),"aria-label":s("recommendations.aria.heatmap"),"data-testid":"heatmap-button",children:e.jsx(Fe,{})})}),e.jsx(oe,{}),e.jsx(A,{tooltip:s("recommendations.actions.invert"),selected:j,children:e.jsx(O,{color:"inherit",disabled:w!=="heat",onClick:()=>{w==="heat"&&h(v=>!v)},"aria-label":s("recommendations.aria.invert"),children:e.jsx(En,{})})}),e.jsx(A,{tooltip:s("recommendations.actions.refresh"),children:e.jsx(O,{color:"inherit",onClick:()=>{w==="grid"?o():y()},"aria-label":s("recommendations.aria.refresh"),children:e.jsx(Ae,{})})})]}),w==="heat"&&e.jsxs(e.Fragment,{children:[e.jsx(Ke,{user:l,dimensions:25,invert:j},`heat-${g}`),e.jsxs("div",{className:q.infoBar,children:[e.jsx(je,{}),e.jsx("span",{children:s("recommendations.descriptions.heatHint")})]})]}),w==="grid"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{selected:c,onSelect:v=>m(G=>G===v?void 0:v),images:C.map(v=>v.id)}),!M&&e.jsxs("div",{className:q.infoBar,children:[e.jsx(je,{}),e.jsx("span",{children:s("recommendations.descriptions.selectHint")})]}),M&&e.jsx(Rt,{userId:l,recommendation:M,hideCandidate:r.hideCandidateOrigin,hideExplain:r.hideExplainedScores})]}),e.jsx("div",{style:{flexGrow:5,flexShrink:1}})]})})}export{vn as A,Qn as R,_n as a};
