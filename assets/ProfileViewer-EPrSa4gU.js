import{b as C,R as w,r as l,l as y,j as e,t as E,i as I,u as k,v as L,O as P}from"./index-ChHXuf40.js";import{E as O}from"./ErrorDialog-Du5KM0FM.js";import{f as U}from"./random-CgHj7PjC.js";import{B as z}from"./BlockDialog-D1_3euXm.js";import{I as R,Y as D}from"./peer-CwAa3h8x.js";import{c as b}from"./sessionState-BwviDT66.js";import{a as A}from"./configState-BS87aI9Z.js";import{L as B}from"./logger-D3dC2Cq8.js";import{C as Y}from"./ContentLoader-dUF1ihTm.js";import{Q as F,P as M}from"./Person-BZI0jAoF.js";import{I as Q}from"./ImageSearch-B_1ksRDv.js";import{I as f}from"./IconButton-BXLcq7Mr.js";import"./errorState-mvpFx4to.js";import"./Close-Dh1l5TZE.js";import"./DialogContent-_GwcI3J5.js";import"./createSimplePaletteValueFilter-CLdyqM5U.js";import"./Portal-BpkAKKpt.js";import"./Modal-DQ9h7Q_m.js";import"./useSlot-BVU38s2u.js";import"./DialogTitle-DRIas77U.js";import"./Typography-8VlALfQ4.js";import"./index-BfNLg11A.js";import"./settings-DBbq7qFG.js";import"./menuState-BrKGn-Zy.js";import"./settingsState-D7smp1AL.js";import"./lz-string-CzHELm9r.js";import"./localiser-C36yOspj.js";import"./LinearProgress-li3lTmA_.js";const V="_container_1mw2h_3",$="_navOuter_1mw2h_56",K="_appNav_1mw2h_64",q="_connectionStatus_1mw2h_72",u={container:V,navOuter:$,appNav:K,connectionStatus:q},G="genai_somekone_username";function H({server:n,mycode:r,children:s,onID:c}){const d=C(A),i=w(b),[g,h]=l.useState(),[j,_]=l.useState(!1),{profiler:t,recommender:v,actionLog:x}=y(),S=l.useCallback(o=>{if(o.event==="eter:reguser"){try{t.createUserProfile(o.id,o.username)}catch(p){console.warn(p)}c(o.id)}else if(o.event==="eter:profile_data")try{t.replaceProfile(o.id,o.profile)}catch{}else o.event==="eter:action_log"?x.appendActionLog(o.log,o.id):o.event==="eter:recommendations"?v.appendRecommendations(o.id,o.recommendations):o.event==="eter:config"&&(d(p=>({...p,...o.configuration})),o.content&&h(o.content))},[d,c,t,x,v]),{ready:a,send:m,peer:N}=R({host:void 0,secure:!1,key:"peerjs",port:443,code:n&&`sm-${r}`,server:`sm-${n}`,onData:S});return l.useEffect(()=>{if(i&&m&&a){try{window.sessionStorage.setItem(G,i)}catch{}t.setUserName(t.getCurrentUser(),i),m({event:"eter:reguser",username:i,id:t.getCurrentUser()})}},[i,m,a,t]),e.jsxs(e.Fragment,{children:[a&&j&&e.jsx(B,{sender:m,children:s}),e.jsx(Y,{content:g,onLoaded:()=>_(!0),noSession:!0}),e.jsx("div",{className:u.connectionStatus,children:e.jsx(D,{api:void 0,appName:"somekone",ready:a,peer:N,visibility:0})})]})}function J(){const n=E(),r=I(),s=n.pathname.split("/").pop();return e.jsx("div",{className:u.navOuter,children:e.jsxs("nav",{className:u.appNav,"data-testid":"app-nav",children:[e.jsx(f,{color:"inherit",size:"large",onClick:()=>r("data",{replace:!0}),children:e.jsx(F,{fontSize:"inherit"})}),e.jsx(f,{color:"inherit",size:"large",onClick:()=>r("profile",{replace:s!=="data"}),children:e.jsx(M,{fontSize:"inherit"})}),e.jsx(f,{color:"inherit",size:"large",onClick:()=>r("recommendations",{replace:s!=="data"}),children:e.jsx(Q,{fontSize:"inherit"})})]})})}function we(){const{code:n}=k(),r=U(10),s=L();return e.jsxs(e.Fragment,{children:[e.jsxs(H,{server:n,mycode:r,onID:c=>{s.setUser(c)},children:[e.jsxs("div",{className:u.container,children:[e.jsx(P,{}),e.jsx(J,{}),e.jsx(z,{})]}),e.jsx("span",{})]}),e.jsx(O,{})]})}export{we as Component};
