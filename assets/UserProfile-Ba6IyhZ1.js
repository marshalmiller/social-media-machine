import{c as M,v as C,R as E,r as b,a5 as R,j as s}from"./index-ChHXuf40.js";import{s as j,U as S}from"./UserProfilePure-DK7r6jJs.js";import{u as y}from"./profiler-BgoGrxGa.js";import{F as B}from"./FileSaver.min-D29rPHm2.js";import{P as D}from"./PrintButton-DlOyJ0WV.js";import{I}from"./Item-BHRpsj3I.js";import{I as U}from"./IconMenuInline-tbFKdX6Z.js";import{a as _}from"./configState-BS87aI9Z.js";import{s as F}from"./svgToPNG-Ltd00H6X.js";import{D as N}from"./Download-_Q7eoY82.js";import{I as k}from"./IconButton-BXLcq7Mr.js";function A(i){const n=new Map;i.affinities.topics.seenTopics.forEach(e=>{n.set(e.label,e.weight)});const r=i.affinities.topics.seenTopics.reduce((e,t)=>e+t.weight,0),m=i.affinities.topics.sharedTopics.map(e=>({label:e.label,percent:e.weight/(n.get(e.label)||1),count:e.weight,total:n.get(e.label)||0})),a=i.affinities.topics.commentedTopics.map(e=>({label:e.label,percent:e.weight/(n.get(e.label)||1),count:e.weight,total:n.get(e.label)||0})),p=i.affinities.topics.viewedTopics.map(e=>({label:e.label,percent:e.weight/(n.get(e.label)||1),count:e.weight,total:n.get(e.label)||0})),o=i.affinities.topics.followedTopics.map(e=>({label:e.label,percent:e.weight/(n.get(e.label)||1),count:e.weight,total:n.get(e.label)||0})),g=i.affinities.topics.reactedTopics.map(e=>({label:e.label,percent:e.weight/(n.get(e.label)||1),count:e.weight,total:n.get(e.label)||0})),d=i.affinities.topics.sharedTopics.reduce((e,t)=>e+t.weight,0),f=i.affinities.topics.commentedTopics.reduce((e,t)=>e+t.weight,0),u=i.affinities.topics.viewedTopics.reduce((e,t)=>e+t.weight,0),h=i.affinities.topics.followedTopics.reduce((e,t)=>e+t.weight,0),w=i.affinities.topics.reactedTopics.reduce((e,t)=>e+t.weight,0);return{shared:m,commented:a,viewed:p,followed:o,reacted:g,sharedPercent:d/r,commentedPercent:f/r,viewedPercent:u/r,followedPercent:h/r,reactedPercent:w/r}}function X({id:i,disableMenu:n,noTagSummary:r}){const{t:m}=M(),a=C(),p=i||a.getCurrentUser(),o=y(p),g=E(_),d=b.useRef(null),f=b.useMemo(()=>A(o),[o]),u=b.useMemo(()=>{const t=new Map;let c=0;return a.graph.getRelated("engaged",p,{period:20*60*1e3}).forEach(l=>{if(l.weight===0)return;c=Math.max(l.weight,c),a.graph.getRelated("topic",l.id,{count:5}).forEach(v=>{if(v.weight===0)return;const P=R(v.id),T=t.get(P)||[];T.push(l),t.set(P,T)})}),{map:t,max:c}},[p,a.graph]),h=o.affinities.topics.topics.reduce((t,c)=>t+c.weight,0),w=b.useMemo(()=>o?o.affinities.topics.topics.filter(t=>t.weight>0).map(t=>{var x;const c=u.map.get(t.label)||[];return{topic:t.label,score:t.weight/h,image:c.length>0?a.content.getContentData(c[0].id,!0):void 0,images:((x=u.map.get(t.label))==null?void 0:x.map(l=>({weight:l.weight,image:a.content.getContentData(l.id,!0)||""})))||[]}}):[],[o,a,u,h]),e=()=>{d.current&&F(d.current,4).then(t=>{B.saveAs(t,`wordcloud_${o.name}.png`)})};return s.jsx("div",{className:j.outerContainer,children:s.jsxs("div",{className:j.container,tabIndex:0,children:[!(g!=null&&g.disablePrinting)&&!n&&s.jsxs(U,{children:[s.jsx(I,{tooltip:m("profile.actions.print"),children:s.jsx(D,{ariaLabel:m("profile.actions.print"),data:()=>({title:o.name,summary:f,topics:w,engagement:Math.min(1,o.engagement/(a.getBestEngagement()||1)),wordCloud:o.affinities.topics.topics}),path:"profile"})}),s.jsx(I,{tooltip:m("profile.actions.download"),children:s.jsx(k,{onClick:e,color:"inherit","aria-label":m("profile.actions.download"),children:s.jsx(N,{})})})]}),s.jsx(S,{ref:d,topics:w,summary:r?void 0:f,wordCloud:o.affinities.topics.topics,engagement:Math.min(1,o.engagement/(a.getBestEngagement()||1))})]})})}export{X as P};
