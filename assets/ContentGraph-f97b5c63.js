import{r as t,j as y,a1 as W,a2 as A,R as w,g as $}from"./index-02b2945e.js";import{G as q}from"./Graph-d1b46b16.js";import{b as B}from"./content-ab9124ab.js";import{p as F,q as H,r as U,t as X}from"./settingsState-c28045a5.js";import{a as J}from"./graph-01dd06dc.js";import{a as K}from"./events-63b5f19e.js";import"./colours.module-29b309d0.js";import"./FileSaver.min-7671c644.js";import"./svgToPNG-975d57d1.js";import"./ProgressDialog-7226fde1.js";import"./DialogContent-d100c3e0.js";import"./createSimplePaletteValueFilter-b2e05aa4.js";import"./Portal-a2b43acb.js";import"./Modal-2fc077e7.js";import"./IconButton-02bc1303.js";import"./useSlot-050d423d.js";import"./DialogTitle-3bd65ba4.js";import"./Typography-0738e1b3.js";import"./index-720786c4.js";import"./LinearProgress-51654afb.js";const O="rgb(174, 37, 174)",Q="_group_1yuy7_3",V="_outerCircle_1yuy7_3",Y="_disabledGroup_1yuy7_9 _group_1yuy7_3",z="_selectedCircle_1yuy7_20",ee="_pulse_1yuy7_1",te="_selectedLink_1yuy7_42",x={secondary:O,group:Q,outerCircle:V,disabledGroup:Y,selectedCircle:z,pulse:ee,selectedLink:te};function se({id:n,selected:s,disabled:a,size:o}){const m=t.useRef(null),c=B(n);return y.jsxs("g",{className:a?x.disabledGroup:x.group,ref:m,"data-testid":`topic-node-${n}`,children:[y.jsx("circle",{className:s?x.selectedCircle:x.outerCircle,"data-testid":"profile-selected",r:s?o+35:o+30}),y.jsx("circle",{"data-testid":"profile-circle",r:o,fill:"white",stroke:"#0A869A",strokeWidth:10,"data-nodeitem":!0}),y.jsx("image",{href:c,width:o,height:o,x:-o/2,y:-o/2,preserveAspectRatio:"none",clipPath:"inset(0% round 20px)"})]})}function G(n,s){return n.getRelated("coengaged",s,{count:10})}function oe(n){const s=t.useRef(new Map),[a,o]=t.useReducer(u=>++u,0),m=W(),c=A();return t.useEffect(()=>{n.forEach(u=>{const p=G(c,u);let l=0,i=1e6;p.forEach(g=>{l=Math.max(l,g.weight),i=Math.min(i,g.weight)}),s.current.set(u,{nodes:p,maxSimilarity:l,minSimilarity:i})}),o()},[n,c]),t.useEffect(()=>{const u=p=>{const l=G(c,p);let i=0,g=1e6;l.forEach(h=>{i=Math.max(i,h.weight),g=Math.min(g,h.weight)}),s.current.set(p,{nodes:l,maxSimilarity:i,minSimilarity:g}),o()};return m.on("edgetype-coengaged",u),()=>{m.off("edgetype-coengaged",u)}},[c,m]),t.useMemo(()=>({similar:s.current}),[a])}const v=.02,ne=50,ie=400,re=200;function ae(n,s){const o=n.getRelated("engaged",s,{count:10,timeDecay:.1,period:36e5}).reduce((m,c)=>m+c.weight,0);return Math.min(ie,o*re)+ne}function ce(){const[n,s]=t.useState([]),[a,o]=t.useState([]),m=w(F),c=w(H),u=w(U),p=w(X),l=J("content"),i=$(),g=A(),h=oe(l),[M,N]=t.useState(),[I,E]=t.useState(5),[D,Z]=t.useState(),[P,R]=t.useState(),L=t.useCallback(()=>{const e=l.filter(r=>{const d=h.similar.get(r);return((d==null?void 0:d.maxSimilarity)||0)>v});e.sort((r,d)=>{var S,k;return(((S=i.getContentStats(d))==null?void 0:S.engagement)||0)-(((k=i.getContentStats(r))==null?void 0:k.engagement)||0)});const C=e.slice(0,Math.max(20,Math.floor(.4*e.length))).map(r=>({id:r,label:r,size:ae(g,r)}));o(C);const _=[];e.forEach(r=>{const d=h.similar.get(r);if(d){const S=d.maxSimilarity;if(S<=v)return;const k=d.nodes.reduce((f,T)=>{var j;return Math.max(f,((j=h.similar.get(T.id))==null?void 0:j.maxSimilarity)||0)},0),b=Math.max(k,S);d.nodes.forEach(f=>{f.weight>(1-p)*S&&r!==f.id&&_.push({source:r,target:f.id,strength:f.weight/b,actualStrength:f.weight/b})})}}),s(_)},[l,h,p,i,g]);return t.useEffect(()=>{L()},[L]),y.jsx(q,{links:n,nodes:a,linkScale:m,linkStyles:P,charge:u,showLines:c,onSelect:e=>{M||E(2);const C=new Map;C.set(e.id,{className:x.selectedLink,width:_=>1+Math.floor(_.strength*_.strength*60)}),R(C),Z([e.x||0,e.y||0]),N(e.id)},onUnselect:()=>{N(void 0),R(void 0),E(5)},focusNode:M,zoom:I,center:D,defaultLinkStyle:{className:x.link,opacity:e=>e.strength*.8+.2,width:e=>5+Math.floor(e.strength*80)},children:a.map(e=>y.jsx(se,{id:e.id,size:e.size,selected:e.id===M,disabled:!1},e.id))})}function be(){const[n,s]=t.useReducer(a=>++a,0);return K(()=>{s()},[],"refresh_graph"),y.jsx(ce,{},`k-${n}`)}export{be as Component};
