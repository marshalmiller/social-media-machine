import{j as t,r as o,c as O,I as ue,g as he,a7 as de,v as me,p as ve,R as Z}from"./index-ChHXuf40.js";import{s as h,C as pe,a as ae,F as be}from"./CommentBox-7mwBcOn9.js";import{c as $,I as fe}from"./IconButton-BXLcq7Mr.js";import{U as we}from"./UserListing-Da09B9Tx.js";import{a as xe,u as ge,c as je}from"./content-CTNkBplU.js";import{l as Ce}from"./localiser-C36yOspj.js";import{C as ke}from"./Close-Dh1l5TZE.js";import{a as Se,g as ye,u as _e,s as ne,c as Ie,b as Re,m as Ne}from"./createSimplePaletteValueFilter-CLdyqM5U.js";import{u as De}from"./useSlot-BVU38s2u.js";import{L as Te}from"./LangSelect-Cnhm6nX0.js";import{c as Ee}from"./configState-BS87aI9Z.js";import{u as Me}from"./recommender-Dk-Nrkxt.js";import{a as Fe,i as Ae}from"./sessionState-BwviDT66.js";const Pe=$(t.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function Oe(e){return Se("MuiAvatar",e)}ye("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const Ue=e=>{const{classes:s,variant:r,colorDefault:c}=e;return Re({root:["root",r,c&&"colorDefault"],img:["img"],fallback:["fallback"]},Oe,s)},ze=ne("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:r}=e;return[s.root,s[r.variant],r.colorDefault&&s.colorDefault]}})(Ne(({theme:e})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(e.vars||e).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:{color:(e.vars||e).palette.background.default,...e.vars?{backgroundColor:e.vars.palette.Avatar.defaultBg}:{backgroundColor:e.palette.grey[400],...e.applyStyles("dark",{backgroundColor:e.palette.grey[600]})}}}]}))),Be=ne("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,s)=>s.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),Le=ne(Pe,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,s)=>s.fallback})({width:"75%",height:"75%"});function He({crossOrigin:e,referrerPolicy:s,src:r,srcSet:c}){const[a,l]=o.useState(!1);return o.useEffect(()=>{if(!r&&!c)return;l(!1);let p=!0;const d=new Image;return d.onload=()=>{p&&l("loaded")},d.onerror=()=>{p&&l("error")},d.crossOrigin=e,d.referrerPolicy=s,d.src=r,c&&(d.srcset=c),()=>{p=!1}},[e,s,r,c]),a}const $e=o.forwardRef(function(s,r){const c=_e({props:s,name:"MuiAvatar"}),{alt:a,children:l,className:p,component:d="div",slots:v={},slotProps:j={},imgProps:S,sizes:R,src:w,srcSet:x,variant:i="circular",...C}=c;let f=null;const m={...c,component:d,variant:i},y=He({...S,...typeof j.img=="function"?j.img(m):j.img,src:w,srcSet:x}),b=w||x,g=b&&y!=="error";m.colorDefault=!g,delete m.ownerState;const k=Ue(m),[T,N]=De("img",{className:k.img,elementType:Be,externalForwardedProps:{slots:v,slotProps:{img:{...S,...j.img}}},additionalProps:{alt:a,src:w,srcSet:x,sizes:R},ownerState:m});return g?f=t.jsx(T,{...N}):l||l===0?f=l:b&&a?f=a[0]:f=t.jsx(Le,{ownerState:m,className:k.fallback}),t.jsx(ze,{as:d,className:Ie(k.root,p),ref:r,...C,ownerState:m,children:f})}),Ve="_feedView_trlpo_3",We="_footerOuter_trlpo_17",re={feedView:Ve,footerOuter:We},Ge="_container_st505_3",qe="_nopadContainer_st505_21 _container_st505_3",Xe="_placeholder_st505_27",Ke="_outer_st505_34",Je="_titleOuter_st505_63",Qe="_title_st505_63",Ye="_language_st505_84",E={container:Ge,nopadContainer:qe,placeholder:Xe,outer:Ke,titleOuter:Je,title:Qe,language:Ye},Ze=$(t.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H6l-2 2V4h16z"}),"ChatBubbleOutline"),et=$(t.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder"),tt=$(t.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"}),"Reply"),st=4e3,nt=1e3;function oe({onClose:e,children:s,horizontal:r,vertical:c,noTimeout:a}){const l=o.useRef(-1),p=o.useCallback(()=>{l.current!==-1&&clearTimeout(l.current),l.current=window.setTimeout(()=>{l.current=-1,e&&e()},nt)},[e]),d=o.useCallback(()=>{l.current!==-1&&clearTimeout(l.current)},[]);return o.useEffect(()=>(a||(l.current=window.setTimeout(()=>{l.current=-1,e&&e()},st)),()=>{l.current!==-1&&clearTimeout(l.current)}),[e,a]),t.jsx("div",{className:`${h.panel} ${h[r]} ${h[c]}`,onMouseLeave:p,onMouseEnter:d,children:s})}function ot({onClose:e,onChange:s}){const{t:r}=O(),c=o.useCallback(a=>{s&&s("public",a[0]),e&&e()},[s,e]);return t.jsx(oe,{horizontal:"hfull",vertical:"vfull",onClose:e,children:t.jsxs("div",{className:h.sharecontainer,"data-testid":"feed-image-share-panel",children:[t.jsx("div",{className:h.shareLabel,children:r("feed.titles.shareWith")}),t.jsx(we,{onSelect:c})]})})}function at({onClose:e,onComment:s,id:r,disabled:c}){const{t:a}=O(),[l,p]=o.useState(!1),d=xe(r)||[];return t.jsx(oe,{horizontal:"hfull",vertical:"bottom",onClose:e,noTimeout:!0,children:t.jsxs("div",{className:h.commentbubble,"data-testid":"feed-image-comment-panel",children:[!c&&t.jsx(pe,{id:r,onClose:e,onComment:s}),t.jsxs("ul",{className:h.commentList,children:[d.length===0&&t.jsx("li",{children:a("feed.messages.noComments")}),d.length>0&&t.jsxs(t.Fragment,{children:[!l&&t.jsx(ae,{comment:d[0].comment,user:d[0].userId}),l&&d.map((v,j)=>t.jsx(ae,{comment:v.comment,user:v.userId,noLimit:!0},j)),d.length>1&&!l&&t.jsx("li",{children:t.jsx(ue,{"data-testid":"moreComments-button",size:"small",style:{marginLeft:"0.5rem"},onClick:()=>p(!0),children:a("feed.actions.moreComments")})})]})]})]})})}function rt({onClose:e,labels:s}){const{i18n:r}=O();return t.jsx(oe,{horizontal:"right",vertical:"top",onClose:e,children:t.jsx("div",{className:h.labelcontainer,"data-testid":"feed-image-label-panel",children:s.slice(0,5).map((c,a)=>t.jsxs("div",{className:h.topicLabel,children:["#",Ce.getLocalisedLabel(c,r.language)]},a))})})}const ct="_button_w4k03_3",lt="_dot_w4k03_7",it="_leftDot_w4k03_22 _dot_w4k03_7",ee={button:ct,dot:lt,leftDot:it};function te({count:e,position:s="right",...r}){return t.jsxs("div",{className:ee.button,children:[t.jsx(fe,{...r,"data-count":e}),e>0&&t.jsx("div",{className:s==="right"?ee.dot:ee.leftDot,children:e})]})}const ut=10;function dt(e){let s=0,r;for(r=0;r<e.length;r+=1)s=e.charCodeAt(r)+((s<<5)-s);let c="#";for(r=0;r<3;r+=1){const a=s>>r*8&255;c+=`00${a.toString(16)}`.slice(-2)}return c}function mt(e){const s=e.split(" ");return{sx:{bgcolor:dt(e)},children:`${s[0][0].toLocaleUpperCase()}${s.length>1?s[1][0].toLocaleUpperCase():""}`}}function ft({id:e,onClick:s,onLike:r,onFollow:c,onUnfollow:a,onShare:l,onComment:p,onHide:d,active:v,visible:j,noActions:S,showLabels:R,reason:w,noComments:x,noLike:i,noFollow:C,noShare:f}){const{t:m}=O(),y=he(),[b,g]=ge(e),[k,T]=o.useState("none"),[N,_]=o.useState(!1),[I,D]=o.useState("none"),[P,V]=o.useState(!1),[W,U]=o.useReducer(n=>++n,0),{reactions:z,shares:F}=je(e),A=o.useCallback(()=>{s&&s(e),D("none")},[s,e]),G=o.useCallback(()=>{T(n=>{const u=n==="none"?"like":"none";return r&&r(e,u),u})},[r,e]),q=o.useCallback((n,u)=>{l&&l(e,n,u)},[l,e]),X=o.useCallback(n=>{p&&(p(e,n),U())},[p,e]),K=o.useCallback(n=>{D("share"),n.stopPropagation()},[D]),J=o.useCallback(n=>{D(u=>u==="comment"?"none":"comment"),n.stopPropagation()},[D]),Q=o.useCallback(()=>{V(n=>(c&&!n&&c(e),a&&n&&a(e),!n))},[c,e,a]),B=o.useCallback(()=>{D("none")},[]);return o.useEffect(()=>{v||D("none")},[v]),!j||!g||!b?null:t.jsx("div",{className:h.container,children:t.jsxs("div",{className:v||S?h.activeImageContainer:h.imageContainer,children:[(v||S)&&!w&&t.jsxs("div",{className:h.name,children:[t.jsx($e,{...mt(b.author||"Unknown")}),t.jsx("span",{className:h.author,children:b.author||"Unknown"}),!S&&!C&&t.jsx(ue,{onClick:Q,"aria-pressed":P,"data-testid":"feed-image-follow-button",color:"inherit",variant:"outlined",children:m(P?"feed.actions.unfollow":"feed.actions.follow")})]}),w&&t.jsx("div",{className:h.reason,children:w}),v&&!S&&d&&t.jsx("div",{className:h.topRightButtons,children:t.jsx(fe,{color:"inherit",onClick:()=>{d(e),_(!0)},"aria-label":m("feed.aria.hide"),children:t.jsx(ke,{color:"inherit",fontSize:"medium"})})}),t.jsx("img",{onClick:A,className:h.instaImage,src:g,alt:"Insta Upload","data-testid":"feed-image-element"}),v&&!S&&t.jsxs("div",{className:h.buttonRow,onClick:A,children:[!i&&t.jsx(te,{count:z,className:k!=="none"?h.liked:"",onClick:()=>G(),color:"inherit","data-testid":"feed-image-like-button","aria-label":m("feed.aria.showLikeOptions"),children:k!=="none"?t.jsx(be,{color:"inherit",fontSize:"large"}):t.jsx(et,{color:"inherit",fontSize:"large"})}),!x&&t.jsx(te,{count:y.getComments(e).length,color:"inherit",onClick:J,"data-testid":"feed-image-comment-button","aria-label":m("feed.aria.showComments"),children:t.jsx(Ze,{color:"inherit",fontSize:"large"})}),!f&&t.jsx(te,{count:F,position:"left",color:"inherit",onClick:K,"data-testid":"feed-image-share-button","aria-label":m("feed.aria.showShareOptions"),children:t.jsx(tt,{color:"inherit",fontSize:"large",style:{transform:"scaleX(-1)"}})})]}),v&&R&&I==="none"&&t.jsx(rt,{labels:b.labels.filter(n=>n.weight>0).map(n=>n.label)}),v&&I==="share"&&t.jsx(ot,{onClose:B,onChange:q}),v&&I==="comment"&&t.jsx(at,{id:e,onClose:B,onComment:X,disabled:W>=ut}),N&&t.jsx("div",{className:h.blocker,children:m("feed.labels.hidden")})]})})}function ce({size:e}){var c;const s=o.useRef(null),r=e>0?e*((((c=s.current)==null?void 0:c.clientWidth)||0)+50):0;return t.jsx("div",{ref:s,className:E.placeholder,style:{height:`${r}px`}})}function ht(){const[e,s]=o.useState(!0);return o.useEffect(()=>{const r=()=>{s(!1)},c=()=>{s(!0)};return window.addEventListener("blur",r),window.addEventListener("focus",c),()=>{window.removeEventListener("blur",r),window.removeEventListener("focus",c)}},[s]),e}const le=5e3,ie=130,se=50;function vt({id:e,images:s,onView:r,onMore:c,onLog:a,noActions:l,showLabels:p,alwaysActive:d,noComments:v,noLike:j,noFollow:S,noShare:R,noHeader:w,noPadding:x}){const{t:i}=O(),C=o.useRef(null),[f,m]=o.useState(0),y=o.useRef(-1),b=o.useRef(0),g=o.useRef(0),k=o.useRef(),T=o.useRef(!0),N=o.useRef(0),_=ht(),[I,D]=o.useState(!1),P=de(),V=me();k.current=s[f];const W=d||I&&_;o.useEffect(()=>{const n=Date.now();_?(N.current=n,b.current=n,a({activity:"begin",timestamp:n}),C.current&&C.current.focus()):k.current&&a({activity:"end",timestamp:n,value:n-N.current,id:k.current.contentId})},[_,a]),o.useEffect(()=>{T.current=!0},[s]);const U=o.useCallback(n=>{const u=s[n];u&&a({activity:"seen",id:u.contentId,timestamp:Date.now()})},[s,a]),z=o.useCallback((n,u)=>{a({activity:"dwell",value:n,id:s[u].contentId,timestamp:Date.now()})},[s,a]);o.useEffect(()=>{const n=Date.now();if(f!==y.current){if(y.current>=0){const u=n-b.current;z(u,y.current),P.createEngagementEntry(e,s[y.current].contentId)}U(f),b.current=n,y.current=f}},[f,r,a,s,z,U,P,e]);const F=o.useCallback(()=>{const n=Date.now();n-g.current>le&&(b.current=n),g.current=n,C.current&&!I&&C.current.focus()},[I]),A=!w,G=o.useCallback(n=>{const u=n.currentTarget.scrollHeight,M=Math.floor((u-(A?ie:se))/s.length),L=n.currentTarget.scrollTop+M/2-(A?ie:se),Y=Math.floor(L/M+.2),H=Date.now();s.length>0&&H-g.current>le&&(a({activity:"inactive",value:H-g.current,id:s[Y].contentId,timestamp:Date.now()}),b.current=H),g.current=H,m(Y),c&&Y>=s.length-4&&(T.current&&c(),T.current=!1),C.current&&!I&&C.current.focus()},[s,m,c,I,a,A]),q=o.useCallback((n,u)=>{a(u!=="none"?{activity:u,id:n,timestamp:Date.now()}:{activity:"unreact",id:n,timestamp:Date.now()})},[a]),X=o.useCallback((n,u,M)=>{u==="public"&&a({activity:"share_public",id:n,timestamp:Date.now(),user:M})},[a]),K=o.useCallback(n=>{a({activity:"follow",id:n,timestamp:Date.now()})},[a]),J=o.useCallback(n=>{a({activity:"unfollow",id:n,timestamp:Date.now()})},[a]),Q=o.useCallback(n=>{a({activity:"hide",id:n,timestamp:Date.now()})},[a]),B=o.useCallback((n,u)=>{a({activity:"comment",id:n,timestamp:Date.now(),value:u.length,content:u})},[a]);return t.jsx("div",{className:E.outer,children:t.jsxs("div",{ref:C,className:x?E.nopadContainer:E.container,onScroll:G,onMouseMove:F,onKeyDown:F,onTouchStart:F,onMouseDown:F,tabIndex:0,onFocus:()=>D(!0),onBlur:n=>{n.currentTarget.contains(n.relatedTarget)||D(!1)},children:[t.jsxs("div",{className:E.titleOuter,style:{minHeight:l?"40px":void 0},children:[!l&&!w&&t.jsxs("header",{className:E.title,children:[t.jsx("img",{src:"/logo48_bw.png",alt:"GenAIMedia Logo",width:48,height:48}),t.jsx("h1",{children:i("feed.titles.main")}),t.jsx("div",{className:E.language,children:t.jsx(Te,{})})]}),w&&t.jsx("div",{style:{height:`${se}px`}})]}),t.jsx("div",{className:E.topSpacer}),t.jsx(ce,{size:f-4}),s.length===0&&t.jsx(ve,{}),s.map((n,u)=>{var M,L;return t.jsx(ft,{id:n.contentId,onLike:q,onFollow:K,onUnfollow:J,onShare:X,onHide:Q,onComment:B,noComments:v,noLike:j,noFollow:S,noShare:R,active:W&&(u===f||u===0&&f===-1),visible:Math.abs(u-f)<5,noActions:l,showLabels:p,reason:(M=n.injection)!=null&&M.from&&((L=n.injection)==null?void 0:L.reason)==="share"?i("feed.messages.sharedBy",{name:V.getUserName(n.injection.from)}):void 0},u)}),t.jsx(ce,{size:s.length-f-5})]})})}function Nt({onProfile:e,onLog:s,onRecommend:r,id:c,noLog:a,noActions:l,alwaysActive:p,noHeader:d,noPadding:v}){const[j,S]=o.useState([]),R=o.useRef(!0),w=me(),x=c||w.getCurrentUser(),i=Z(Ee(x)),C=o.useMemo(()=>({...i==null?void 0:i.recommendations,coldStart:!a}),[i,a]),{recommendations:f,more:m}=Me(5,x,C),y=de(),b=Z(Fe),g=Z(Ae),k=o.useRef(Date.now());o.useEffect(()=>{if(R.current&&f.length>0){const N=g.filter(_=>_.timestamp>k.current).map(_=>({contentId:_.content,injection:_}));S(_=>[..._,...N,...f.map(I=>({contentId:I.contentId,recommendation:I}))]),k.current=Date.now(),R.current=!1,r&&r(f),e&&e(w.getUserProfile(x))}else R.current&&setTimeout(m,2e3)},[f,e,r,w,x,m,g]);const T=o.useCallback(N=>{a||(y.addLogEntry(N,x),s&&s())},[s,a,y,x]);return o.useEffect(()=>{b&&m()},[m,b]),t.jsxs("section",{className:re.feedView,children:[j.length>0&&t.jsx(vt,{id:x,images:j,onMore:()=>{R.current=!0,m()},onLog:T,noHeader:d,noActions:l,showLabels:i==null?void 0:i.showTopicLabels,alwaysActive:(i==null?void 0:i.alwaysActive)||p,noComments:i==null?void 0:i.disableComments,noLike:i==null?void 0:i.disableLiking,noFollow:i==null?void 0:i.disableFollowing,noShare:i==null?void 0:i.disableSharing,noPadding:v}),t.jsx("div",{className:re.footerOuter})]})}export{Nt as F};
