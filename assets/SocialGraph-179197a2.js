import{c as q,a as N,r as c,j as e,b as re,R as S,g as ve,m as ie}from"./index-02b2945e.js";import{S as Y}from"./Spacer-de9dcc41.js";import{I as ce}from"./IconMenu-6e6ac8e9.js";import{I as D}from"./Item-79c80338.js";import{C as _e,P as De}from"./PhoneAndroid-c91f5110.js";import{s as w,I as ye,T as Pe,C as Re,D as Ge,a as Ue,F as ze,b as Te,P as Ae,R as Fe}from"./DeleteDialog-657ad9e0.js";import{R as Oe}from"./Refresh-d5d9edd3.js";import{s as de,a as me,b as he,c as ue,d as pe,e as V,f as fe,h as ge,i as be,j as xe,k as je,l as $e,m as He,n as We,o as Ke}from"./settingsState-c28045a5.js";import{o as J,n as H,i as Xe,p as Be}from"./menuState-2ff024b1.js";import{D as Ze}from"./Download-633f4aec.js";import{S as Qe}from"./Settings-ceaef721.js";import{u as oe,a as Ye}from"./events-63b5f19e.js";import{C as qe}from"./Close-50ef3ec2.js";import{D as Ve,a as Je}from"./DialogContent-d100c3e0.js";import{D as et}from"./DialogTitle-3bd65ba4.js";import{I as _}from"./IconButton-02bc1303.js";import{F as tt,I as st,S as ot}from"./TextField-43fc95d4.js";import{M as ae}from"./MenuItem-97c66a8d.js";import{F as A,C as F}from"./FormControlLabel-5a6070f0.js";import{S as Z}from"./Slider-01724717.js";import{I as at}from"./ImageCloud-fcac825d.js";import{W as lt}from"./UserProfilePure-9f741110.js";import{L as nt,a as rt}from"./Label-2d9d5124.js";import{u as it}from"./profiler-25e786d5.js";import{i as ct}from"./colours-9cdd3933.js";import{Q as dt,P as mt}from"./Person-411c868c.js";import{I as ht}from"./ImageSearch-6df1d0d1.js";import{g as ut}from"./links-8de2c7fc.js";import{G as pt}from"./Graph-d1b46b16.js";import{c as ft,u as gt}from"./UserListing-e60983b4.js";import"./Tooltip-875b66b4.js";import"./createSimplePaletteValueFilter-b2e05aa4.js";import"./Portal-a2b43acb.js";import"./useSlot-050d423d.js";import"./Popper-912b4204.js";import"./useSlotProps-2393cf25.js";import"./Grow-605dc19c.js";import"./Popover-f0f4a007.js";import"./Modal-2fc077e7.js";import"./debounce-517eeb3c.js";import"./Feed-95058eca.js";import"./style.module-950f526a.js";import"./content-ab9124ab.js";import"./localiser-c0c9a31b.js";import"./LangSelect-6fc7f25d.js";import"./useFormControl-e419a457.js";import"./configState-6be3aa1d.js";import"./recommender-9b8a9795.js";import"./sessionState-6915fb12.js";import"./DataProfile-29b73b7e.js";import"./DataProfilePure-287e5c3b.js";import"./ScorePie-ef00e97d.js";import"./colours.module-29b309d0.js";import"./ChartsOverlay-21326cdb.js";import"./useThemeProps-e50455dd.js";import"./Typography-0738e1b3.js";import"./index-720786c4.js";import"./FileSaver.min-7671c644.js";import"./PrintButton-dcdd5a18.js";import"./random-67c94df7.js";import"./IconMenuInline-1e64afd8.js";import"./svgToPNG-975d57d1.js";import"./UserProfile-c3f95e1b.js";import"./I18nextProvider-f367c211.js";import"./RecommendationsProfile-bfc2e545.js";import"./graphColours-c6ae9e73.js";import"./RadioGroup-2c88d32f.js";import"./SwitchBase-b2e27e4d.js";import"./ImageGrid-ff60fbdd.js";import"./CheckCircle-b71d1d84.js";import"./LocalFireDepartment-2907a69f.js";import"./RecommendationsHeatmap-cbbc4619.js";import"./ProgressDialog-7226fde1.js";import"./LinearProgress-51654afb.js";import"./DialogActions-6d630794.js";import"./style.module-fd5d79c8.js";function bt({open:s,onClose:a}){const{t}=q(),[d,m]=N(de),[h,b]=N(me),[n,u]=N(he),[r,f]=N(ue),[C,M]=N(pe),[x,I]=N(V),[g,k]=N(fe),[E,v]=N(ge),[P,R]=N(be),[G,U]=N(xe),z=c.useCallback((p,j)=>u(j),[u]);return e.jsxs(Ve,{open:s,onClose:a,scroll:"paper",maxWidth:"xs",fullWidth:!0,children:[e.jsx(et,{children:t("dashboard.titles.socialGraph")}),e.jsx(_,{"aria-label":"close",onClick:a,sx:{position:"absolute",right:8,top:8,color:p=>p.palette.grey[500]},children:e.jsx(qe,{})}),e.jsx(Je,{children:e.jsxs("div",{className:w.column,children:[e.jsxs(tt,{fullWidth:!0,children:[e.jsx(st,{id:"sg-theme-select",children:t("dashboard.labels.theme")}),e.jsxs(ot,{labelId:"sg-theme-select",value:x,label:t("dashboard.labels.theme"),onChange:p=>I(p.target.value),children:[e.jsx(ae,{value:"default",children:t("dashboard.labels.themeDefault")}),e.jsx(ae,{value:"highContrast",children:t("dashboard.labels.themeHighContrast")})]})]}),e.jsx("div",{className:w.spacer}),e.jsx(A,{control:e.jsx(F,{checked:d,onChange:(p,j)=>m(j)}),label:t("dashboard.labels.showLines")}),e.jsx(A,{control:e.jsx(F,{checked:h,onChange:(p,j)=>b(j)}),label:t("dashboard.labels.showLabels")}),e.jsx(A,{control:e.jsx(F,{checked:r,onChange:(p,j)=>f(j)}),label:t("dashboard.labels.egoSelect")}),e.jsx(A,{control:e.jsx(F,{checked:C,onChange:(p,j)=>M(j)}),label:t("dashboard.labels.allLinks")}),e.jsx(A,{control:e.jsx(F,{checked:P,onChange:(p,j)=>R(j)}),label:t("dashboard.labels.autoCamera")}),e.jsx(A,{control:e.jsx(F,{checked:G,onChange:(p,j)=>U(j)}),label:t("dashboard.labels.autoEdges")}),e.jsx("div",{className:w.spacer}),e.jsx("div",{id:"social-edge-scaling-label",className:w.label,children:t("dashboard.labels.edgeScaling")}),e.jsx(Z,{"aria-labelledby":"social-edge-scaling-label",value:n,onChange:z,min:.1,max:2,step:.1,valueLabelDisplay:"auto"}),e.jsx("div",{id:"social-similarity-label",className:w.label,children:t("dashboard.labels.similarityThreshold")}),e.jsx(Z,{"aria-labelledby":"social-similarity-label",value:g,onChange:(p,j)=>k(j),min:.01,max:.5,step:.01,valueLabelDisplay:"auto",disabled:G}),e.jsx("div",{id:"social-limit-label",className:w.label,children:t("dashboard.labels.limitLinks")}),e.jsx(Z,{"aria-labelledby":"social-limit-label",value:E,onChange:(p,j)=>v(j),min:1,max:10,step:1,valueLabelDisplay:"auto"})]})})]})}function xt(){const{t:s}=q(),[a,t]=N(je),d=re(J),m=S(H),h=S(Xe),b=S(Be),n=c.useRef(),u=oe("save_graph"),r=oe("refresh_graph"),[f,C]=c.useState(!1);return c.useEffect(()=>{m&&m!==n.current&&b!=="none"&&d(b),n.current=m},[m,b,d]),h?e.jsxs(e.Fragment,{children:[e.jsxs(ce,{title:s("dashboard.aria.socialMenu"),placement:"top",label:e.jsx("div",{className:w.menuLogo,children:s("dashboard.titles.people")}),children:[e.jsx(D,{tooltip:s("dashboard.labels.profileImage"),selected:a==="profileImage",children:e.jsx(_,{color:"inherit",onClick:()=>t("profileImage"),"data-testid":"social-menu-profileImage","aria-label":s("dashboard.labels.profileImage"),children:e.jsx(ye,{})})}),e.jsx(D,{tooltip:s("dashboard.labels.engagedImages"),selected:a==="image",children:e.jsx(_,{color:"inherit",onClick:()=>t("image"),"data-testid":"social-menu-images","aria-label":s("dashboard.labels.engagedImages"),children:e.jsx(_e,{})})}),e.jsx(D,{tooltip:s("dashboard.labels.topicCloud"),selected:a==="word",children:e.jsx(_,{color:"inherit",onClick:()=>t("word"),"aria-label":s("dashboard.labels.topicCloud"),children:e.jsx(Pe,{})})}),e.jsx(Y,{}),e.jsx(Re,{}),e.jsx(Y,{}),e.jsx(D,{tooltip:s("dashboard.labels.saveGraphImage"),children:e.jsx(_,{color:"inherit",onClick:u,"aria-label":s("dashboard.labels.saveGraphImage"),children:e.jsx(Ze,{})})}),e.jsx(D,{tooltip:s("dashboard.labels.refreshGraph"),children:e.jsx(_,{color:"inherit",onClick:r,"aria-label":s("dashboard.labels.refreshGraph"),children:e.jsx(Oe,{})})}),e.jsx(D,{tooltip:s("dashboard.labels.showSocialGraphSettings"),children:e.jsx(_,{color:"inherit",onClick:()=>C(!0),"aria-label":s("dashboard.labels.showSocialGraphSettings"),children:e.jsx(Qe,{})})})]}),e.jsx(bt,{open:f,onClose:()=>C(!1)})]}):null}const Q=10;function jt(s,a){if(s.length===0)return s;const t=s[0].weight;return s.filter(d=>d.weight>=a*t)}const St=c.memo(function({id:a,onResize:t,live:d,selected:m,disabled:h,node:b,fixedSize:n,density:u=1,zoom:r=1}){var z;const[f,C]=c.useState(100),M=S($e),x=S(je),I=ve(),g=it(a),k=c.useCallback(p=>{n||(C(p+20),t(a,p+20),b.size=p+20)},[t,a,n,b]),E=M&&!d,v=E?f*.4:f,P=g.image,R=.1+Math.min(1,(Math.max(1,r)-1)/2)*.3,G=c.useMemo(()=>g!=null&&g.affinities.topics.topics?jt(g.affinities.topics.topics,R):[],[g,R]),U=c.useMemo(()=>g.affinities.contents.contents.map(p=>({weight:p.weight,image:I.getContentData(p.id,!0)||""})),[g,I]);return c.useEffect(()=>{x==="profileImage"&&k(Math.floor(g.engagement*2)+50)},[k,x,g]),e.jsxs("g",{className:h?w.disabledGroup:w.group,children:[e.jsx("circle",{className:m?w.selectedCircle:w.outerCircle,"data-testid":"profile-selected",r:m?v+Q+5:v}),e.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r:v,fill:"white",stroke:((z=b.data)==null?void 0:z.colour)||"#5f7377",strokeWidth:E?5:Q}),!E&&x==="image"&&g.affinities.contents.contents.length>0&&e.jsx(at,{content:U,size:200+Math.floor(100*u),padding:3,onSize:k,className:h?w.disabledImageCloud:void 0,count:4+Math.floor(6*u)}),!E&&x==="word"&&e.jsx(lt,{content:G,size:500,padding:3,className:w.cloudItem,onSize:k}),!E&&x==="score"&&e.jsx(nt,{label:g.engagement.toFixed(),x:0,y:5,fontSize:Math.floor(50+g.engagement*10),color:"#5f7377",fill:"white",padding:0,onResize:k}),!E&&x==="profileImage"&&P&&e.jsx("image",{x:-v,y:-v,width:v*2,height:v*2,href:I.getContentData(P),preserveAspectRatio:"none",clipPath:`circle(${Math.floor(v-Q)}px)`})]})}),Se={default:{transparentLinks:!0,linkColour:"#5f7377"},highContrast:{background:"white",transparentLinks:!1,linkColour:"#aaa",labelColour:"#5f7377"}},Ct=c.memo(function({node:a,scale:t}){var r;const d=S(V),m=5+Math.floor(20/t),h=a.label||"None",b=h.length>=m?`${h.slice(0,m)}...`:h,u=Se[d].labelColour||((r=a.data)==null?void 0:r.colour)||"#5f7377";return h?e.jsx(rt,{label:b,fill:u||"#5f7377",color:ct(u||"#5f7377")?"black":"white",padding:5,scale:Math.max(1,Math.min(t,4))}):null});function It({node:s,scale:a}){var h;const t=((h=s.original)==null?void 0:h.size)||s.size,d=s.x||0,m=(s.y||0)+t+10;return e.jsx("g",{transform:`translate(${Math.floor(d)}, ${Math.floor(m)})`,children:e.jsx(Ct,{node:s,scale:a})})}const le=100,wt=300,Lt=50,Nt=600,kt=1,Mt=4;function ne(s,a,t){return s*(t-a)+a}function Et(s,a,t){const d=Math.sqrt(a/t),m=Math.min(1,Math.max(0,d-le)/(wt-le)),h=s*m,b=ne(h,Lt,Nt),n=ne(h,kt,Mt);return{linkDistance:b,nodeCharge:n,similarPercent:.1,density:m}}function vt({x:s,y:a}){var M,x;const{t}=q(),{profiler:d,actionLog:m,similarity:h}=ie(),[b,n]=c.useState(!1),[u,r]=N(J),[f,C]=N(H);return f?e.jsxs(ce,{title:t("dashboard.aria.socialUserMenu"),placement:"free",x:s,y:a,selected:!!f,label:e.jsx("div",{className:w.menuLogo,children:f?(M=d.getUserData(f))==null?void 0:M.name:t("dashboard.titles.people")}),children:[e.jsx(D,{tooltip:t("dashboard.labels.showFeed"),selected:u==="feed",children:e.jsx(_,{"data-testid":"social-menu-feed-button",color:"inherit",onClick:()=>r("feed"),"aria-label":t("dashboard.labels.showFeed"),children:e.jsx(De,{})})}),e.jsx(D,{tooltip:t("dashboard.labels.showData"),selected:u==="data",children:e.jsx(_,{"data-testid":"social-menu-data-button",color:"inherit",onClick:()=>r("data"),"aria-label":t("dashboard.labels.showData"),children:e.jsx(dt,{})})}),e.jsx(D,{tooltip:t("dashboard.labels.showProfile"),selected:u==="profile",children:e.jsx(_,{"data-testid":"social-menu-profile-button",color:"inherit",onClick:()=>r("profile"),"aria-label":t("dashboard.labels.showProfile"),children:e.jsx(mt,{})})}),e.jsx(D,{tooltip:t("dashboard.labels.showRecommendations"),selected:u==="recommendations",children:e.jsx(_,{"data-testid":"social-menu-recom-button",color:"inherit",onClick:()=>r("recommendations"),"aria-label":t("dashboard.labels.showRecommendations"),children:e.jsx(ht,{})})}),e.jsx(Y,{}),e.jsx(D,{tooltip:t("dashboard.labels.deleteUser"),children:e.jsx(_,{color:"inherit",onClick:()=>n(!0),"aria-label":t("dashboard.labels.deleteUser"),children:e.jsx(Ge,{})})}),e.jsx(Ue,{name:((x=d.getUserData(f))==null?void 0:x.name)||"No Name",open:b,onClose:()=>n(!1),onDelete:()=>{d.removeProfile(f),m.removeLogs(f),h.reset(),C(void 0),n(!1)}})]}):null}function _t(s,a,t,d,m){const h=new Map;return a.map(n=>h.set(n.id,n)),t.map(n=>{var M,x,I;const u=d.get(n)||100,r=m.clusters.get(n),f=r?ft((r==null?void 0:r.label)||""):"#5f7377",C=h.get(n);if(C)return C.size===u&&((M=C.data)==null?void 0:M.colour)===f?C:{...C,size:u,data:{topics:r||[],colour:f,label:(r==null?void 0:r.label)||!1}};{const g=s.getUserProfile(n),k=g.image?(x=s.content.getContentMetadata(g.image))==null?void 0:x.point:void 0;return{id:n,x:k?k[0]*2e3-1e3:void 0,y:k?k[1]*2e3-1e3:void 0,label:s.getUserName(n),size:u,strength:((I=m.similar.get(n))==null?void 0:I.length)||0,data:{topics:r||[],colour:f,label:(r==null?void 0:r.label)||!1}}}})}const Dt=40,yt=10,Pt=60,Rt=.001,Gt=.01;function Ut({liveUsers:s}){const a=c.useRef(new Map),t=c.useRef(1),d=c.useRef(),[m,h]=c.useState([]),[b,n]=c.useState([]),[u,r]=c.useState(),[f,C]=c.useState(),[M,x]=c.useState(),[I,g]=N(H),k=S(J),E=S(he),v=S(de),P=S(He),R=S(We),G=S(ge),U=S(ue),z=S(me),p=S(pe),j=S(V),Ce=S(be),Ie=S(xe),we=S(Ke),[ee,W]=N(fe),T=gt(),K=T.users,X=c.useMemo(()=>{const o=new Set;return s==null||s.forEach(i=>{o.add(i)}),o},[s]),{profiler:O,similarity:te}=ie(),{nodeCharge:Le,linkDistance:Ne,density:ke}=Et(E,window.innerWidth*window.innerHeight,b.length),B=Se[j];c.useEffect(()=>{te.setK(R)},[te,R]),c.useEffect(()=>{const o=ut(T.similar,p,ee,G);h(o)},[T,ee,p,G,h]),c.useEffect(()=>{n(o=>{const i=P?K.filter(l=>{var L;return l!==O.getCurrentUser()&&(((L=T.similar.get(l))==null?void 0:L.length)||0)>0}):K.filter(l=>X.has(l)&&l!==O.getCurrentUser());return _t(O,o,i,a.current,T)})},[K,X,P,T,O,n]);const Me=c.useCallback((o,i)=>{Math.abs(i-(a.current.get(o)||100))<=1||(a.current.set(o,i),n(l=>l.map(L=>L.id===o?(L.size=i,{...L}):L)))},[n]);c.useEffect(()=>{if(I){const o=new Map;o.set(I,{className:w.selectedLink,width:l=>1+Math.floor((l.actualStrength||l.strength)*Pt)});const i=new Set;i.add(I),m.forEach(l=>{(l.source===I||l.target===I)&&(i.add(l.source),i.add(l.target))}),C(i),r(o)}else C(void 0),r(void 0)},[I,m]);const Ee=c.useCallback(o=>{const i=o*E;i>0&&i<Rt?W(l=>Math.min(.5,1.1*l)):i>Gt&&W(l=>Math.max(.01,.9*l))},[W,E]);return e.jsxs(e.Fragment,{children:[e.jsx(pt,{onNodeDensity:Ie?Ee:void 0,autoCamera:Ce,onZoom:o=>{t.current=o},inert:k!=="none"&&I!==void 0,links:m,nodes:b,linkScale:Ne,linkStyles:u,defaultLinkStyle:{className:w.link,opacity:o=>{var i,l,L,y,$,se;return B.transparentLinks?U&&u?0:(i=o.source.data)!=null&&i.label&&((l=o.source.data)==null?void 0:l.label)===((L=o.target.data)==null?void 0:L.label)?.5:.1:U&&u?0:(y=o.source.data)!=null&&y.label&&(($=o.source.data)==null?void 0:$.label)===((se=o.target.data)==null?void 0:se.label)?.8:.3},width:o=>yt+Math.floor(o.strength*Dt),colour:o=>{var i,l,L;return((i=o.source.data)==null?void 0:i.colour)===((l=o.target.data)==null?void 0:l.colour)?(L=o.source.data)==null?void 0:L.colour:B.linkColour||"#5f7377"}},charge:Le,showLines:v,onSelect:(o,i,l,L)=>{const y=l.getClientRects()[0];d.current=l;const $=L.getBoundingClientRect();x(y?[y.x+y.width/2-$.left,y.y+y.height+20]:[0,0]),g(o.id)},onUnselect:()=>{g(void 0),C(void 0),r(void 0),d.current=void 0,x(void 0)},onDragStop:()=>{var o;if(d.current){const i=d.current.getClientRects()[0],l=(o=d.current)==null?void 0:o.ownerSVGElement;if(i&&l){const L=l.getBoundingClientRect();x([i.x+i.width/2-L.left,i.y+i.height+20])}else x([0,0])}},focusNode:I,zoom:5,LabelComponent:z?It:void 0,injectStyle:e.jsx("style",{children:`.${w.cloudItem} rect {opacity: 0.2; fill: #078092;} .${w.cloudItem} text { fill: #444;}`}),style:{background:B.background},children:b.map(o=>e.jsx(St,{id:o.id,node:o,onResize:Me,live:X.has(o.id),selected:o.id===I,disabled:U&&f?!f.has(o.id):!1,density:ke,zoom:t.current},o.id))}),M&&we&&e.jsx(vt,{x:M[0],y:M[1]})]})}function zt({liveUsers:s}){return e.jsxs(e.Fragment,{children:[e.jsx(Ut,{liveUsers:s}),e.jsx(xt,{}),e.jsx(ze,{}),e.jsx(Te,{}),e.jsx(Ae,{}),e.jsx(Fe,{})]})}function no(){const[s,a]=c.useReducer(d=>++d,0);Ye(()=>{a()},[],"refresh_graph");const t=re(H);return c.useEffect(()=>{t(void 0)},[t]),e.jsx(zt,{},`k-${s}`)}export{no as Component};
