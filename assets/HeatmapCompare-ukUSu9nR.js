import{j as e,c as R,r as c,a as N,g as L,R as k,v as D,a3 as G,l as $}from"./index-ChHXuf40.js";import{S as I}from"./Spacer-Mn4BAxg4.js";import{I as P}from"./IconMenu-BwCk8YCn.js";import{I as v}from"./Item-BHRpsj3I.js";import{c as E,I as S}from"./IconButton-BXLcq7Mr.js";import{L as q}from"./LocalFireDepartment-G8EPqmTC.js";import{R as A}from"./Refresh-CxoqocOo.js";import{D as B}from"./Download-_Q7eoY82.js";import{u as T,a as z}from"./events-DLU3_18Y.js";import{I as O}from"./ImageSearch-B_1ksRDv.js";import{T as V,d as J}from"./autoUsers-BgxAG-dm.js";import{v as U,w as K,x as Q}from"./settingsState-D7smp1AL.js";import{P as W}from"./Popover-3SaqCWbK.js";import{S as w}from"./Slider-CstNE_2p.js";import{U as X}from"./UserDialog-Di7LZn7A.js";import{h as F,H as y,R as Y,M as Z}from"./RecommendationsHeatmap-CFho8frj.js";import{c as ee}from"./configState-BS87aI9Z.js";import{u as te}from"./profiler-BgoGrxGa.js";import"./Tooltip-cL7nY1NY.js";import"./createSimplePaletteValueFilter-CLdyqM5U.js";import"./Portal-BpkAKKpt.js";import"./useSlot-BVU38s2u.js";import"./useSlotProps-BP5ya9qr.js";import"./Grow-B-eHZ5Kq.js";import"./Popper-JH9MxI6g.js";import"./debounce-Be36O1Ab.js";import"./Modal-DQ9h7Q_m.js";import"./UserListing-Da09B9Tx.js";import"./CheckCircle-CXj5CTlc.js";import"./colours-yJq7kSUE.js";import"./Close-Dh1l5TZE.js";import"./DialogContent-_GwcI3J5.js";import"./DialogTitle-DRIas77U.js";import"./Typography-8VlALfQ4.js";import"./index-BfNLg11A.js";import"./svgToPNG-Ltd00H6X.js";import"./FileSaver.min-D29rPHm2.js";import"./ProgressDialog-CeFbeIBT.js";import"./LinearProgress-li3lTmA_.js";const ae="#dfe5e8",oe="_menuLogo_1kir1_3",re="_grid_1kir1_13",ne="_grid1_1kir1_22 _grid_1kir1_13",se="_grid2_1kir1_29 _grid_1kir1_13",ie="_grid3_1kir1_35 _grid_1kir1_13",ce="_grid4_1kir1_41 _grid_1kir1_13",le="_heatCard_1kir1_48",me="_factorMenu_1kir1_56",de="_factorContainer_1kir1_61",he="_label_1kir1_65",g={workspaceBg:ae,menuLogo:oe,grid:re,grid1:ne,grid2:se,grid3:ie,grid4:ce,heatCard:le,factorMenu:me,factorContainer:de,label:he},pe=E(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group"),ge=E(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39"}),"Public"),ue=E(e.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8M12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4m3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"EmojiEmotions");function fe({factor:a,onFactor:r}){const{t:o}=R(),[s,n]=c.useState(null),[l,t]=N(U),d=L(),i=!!s,b=h=>{n(h.currentTarget)},m=()=>{n(null)};return e.jsxs(e.Fragment,{children:[e.jsx(v,{tooltip:o("dashboard.labels.heatmapFactor"),children:e.jsx(S,{onClick:b,id:"cluster-menu-button",color:"inherit","aria-label":o("dashboard.labels.heatmapFactor"),children:e.jsx(V,{})})}),e.jsx(W,{role:"dialog","aria-labelledby":"factor-menu-button",className:g.factorMenu,id:"factor-menu",anchorEl:s,open:i,onClose:m,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:e.jsxs("div",{className:g.factorContainer,children:[e.jsx("div",{id:"factor-colouring-label",className:g.label,children:o("dashboard.labels.heatmapFactor")}),e.jsx(w,{"aria-labelledby":"factor-colouring-label",value:a,onChange:(h,u)=>r(u),min:0,max:10,step:.5,style:{width:"200px"}}),e.jsx("div",{id:"dim-label",className:g.label,children:o("dashboard.labels.heatmapDimension")}),e.jsx(w,{"aria-labelledby":"dim-label",value:l,onChange:(h,u)=>t(u),min:0,max:Math.floor(Math.sqrt(d.getAllContent().length)),step:5,style:{width:"200px"}})]})})]})}function be({mode:a,onMode:r,onOpenUserList:o,onRefresh:s,factor:n,onFactor:l}){const{t}=R(),d=T("save_heat");return e.jsxs(P,{title:t("dashboard.aria.socialMenu"),placement:"top",label:e.jsx("div",{className:g.menuLogo,children:e.jsx(q,{color:"inherit"})}),children:[e.jsx(v,{tooltip:t("dashboard.labels.heatmapGlobal"),selected:a==="global",children:e.jsx(S,{color:"inherit",onClick:()=>r("global"),"data-testid":"heatmap-menu-global","aria-label":t("dashboard.labels.heatmapGlobal"),children:e.jsx(ge,{})})}),e.jsx(v,{tooltip:t("dashboard.labels.heatmapEngagement"),selected:a==="engagement",children:e.jsx(S,{color:"inherit",onClick:()=>r("engagement"),"data-testid":"heatmap-menu-engagement","aria-label":t("dashboard.labels.heatmapEngagement"),children:e.jsx(ue,{})})}),e.jsx(v,{tooltip:t("dashboard.labels.heatmapRecommendation"),selected:a==="recommendation",children:e.jsx(S,{color:"inherit",onClick:()=>r("recommendation"),"data-testid":"heatmap-menu-global","aria-label":t("dashboard.labels.heatmapRecommendation"),children:e.jsx(O,{})})}),e.jsx(I,{}),e.jsx(v,{tooltip:t("dashboard.labels.heatmapUsers"),children:e.jsx(S,{color:"inherit",disabled:a==="global",onClick:o,"data-testid":"heatmap-menu-openusers","aria-label":t("dashboard.labels.heatmapUsers"),children:e.jsx(pe,{})})}),e.jsx(I,{}),e.jsx(fe,{factor:n,onFactor:l}),e.jsx(v,{tooltip:t("dashboard.labels.refresh"),children:e.jsx(S,{color:"inherit",onClick:s,"data-testid":"heatmap-menu-refresh","aria-label":t("dashboard.labels.refresh"),children:e.jsx(A,{})})}),e.jsx(v,{tooltip:t("dashboard.labels.saveGraphImage"),children:e.jsx(S,{color:"inherit",onClick:d,"aria-label":t("dashboard.labels.saveGraphImage"),children:e.jsx(B,{})})})]})}function xe({dimensions:a,invert:r,deviationFactor:o}){const s=c.useRef(),[n,l]=c.useState(),[t,d]=c.useState(!1),i=L();return c.useEffect(()=>{if(d(!0),s.current||(s.current=F(i.graph,a)),s.current){const b=s.current.map(m=>({id:m,weight:i.getContentEngagement(m)}));b.sort((m,h)=>h.weight-m.weight),l(b)}d(!1)},[a,i]),e.jsx(y,{data:n||[],busy:t,dimensions:a,invert:r,deviationFactor:o})}function je({users:a,mapService:r,factor:o,dim:s,imageSet:n}){return e.jsx("div",{className:g[`grid${a.length}`],children:a.map(l=>e.jsx("div",{className:g.heatCard,children:e.jsx(Y,{dimensions:s,user:l,showName:!0,deviationFactor:o,mapService:r,imageSet:n})},l))})}function _e(a,r,o,s){const n=G(a,o);if(n.length<=r)return n;const l=s||new Set,t=[];for(;t.length<r;){const d=Math.floor(Math.random()*n.length),i=o(n[d]);l.has(i)||(l.add(i),t.push(n[d]))}return t}function ve(a,r,o){const s=a.getNodesByType("content");return _e(s,r,n=>n,new Set(o))}function Se({user:a,dimensions:r,showName:o,invert:s,deviationFactor:n,mapService:l,imageSet:t}){const d=k(ee(a)),i=c.useRef(),[b,m]=c.useState(),[h,u]=c.useState(!1),x=te(a),_=D(),C=r||Math.floor(Math.sqrt(_.content.getAllContent().length));return t&&(i.current=t),c.useEffect(()=>{u(!0);const f=_.getEngagedContent(a);i.current||(i.current=[...f.map(p=>p.id),...ve(_.graph,C*C-f.length,f.map(p=>p.id))]);const j=new Map;if(f.forEach(p=>{j.set(p.id,p.weight)}),i.current){const p=i.current.map(M=>({id:M,weight:j.get(M)||0}));p.sort((M,H)=>H.weight-M.weight),m(p)}u(!1)},[C,a,d,x,_]),e.jsx(y,{data:b||[],busy:h,dimensions:r,label:o?x.name:void 0,invert:s,deviationFactor:n,mapService:l})}function Ce({users:a,mapService:r,factor:o,dim:s,imageSet:n}){return e.jsx("div",{className:g[`grid${a.length}`],children:a.map(l=>e.jsx("div",{className:g.heatCard,children:e.jsx(Se,{dimensions:s,user:l,showName:!0,deviationFactor:o,mapService:r,imageSet:n})},l))})}function Me(){const[a,r]=c.useState(!1),[o,s]=c.useState([]),[n,l]=c.useReducer(p=>p+1,0),[t,d]=N(K),[i,b]=c.useState(1),m=k(Q),{profiler:h,content:u}=$(),x=c.useRef(),[_,C]=c.useState(),f=k(U),j=f||Math.floor(Math.sqrt(u.getAllContent().length));return(!x.current||x.current.length<j*j-j)&&(x.current=F(h.graph)),c.useEffect(()=>{(t==="engagement"||t==="recommendation")&&o.length===0&&m===0&&r(!0)},[o,t,m]),c.useEffect(()=>{C(new Z(u,{dataSetSize:o.length,dim:j}))},[u,o,n,t,j]),c.useEffect(()=>{m>0?s(J(h,m)):s([])},[m,h]),e.jsxs(e.Fragment,{children:[t==="recommendation"&&e.jsx(je,{mapService:_,factor:i,users:o,dim:f,imageSet:x.current},`g${n}`),t==="engagement"&&e.jsx(Ce,{mapService:_,factor:i,users:o,dim:f,imageSet:x.current},`g${n}`),t==="global"&&e.jsx("div",{className:g.grid1,children:e.jsx("div",{className:g.heatCard,children:e.jsx(xe,{dimensions:f,deviationFactor:i})})},`g${n}`),e.jsx(X,{open:a,onClose:()=>r(!1),onSelect:s,preSelected:o,multiple:4}),e.jsx(be,{mode:t,onMode:d,onOpenUserList:()=>r(!0),onRefresh:l,factor:i,onFactor:b})]})}function mt(){const[a,r]=c.useReducer(o=>++o,0);return z(()=>{r()},[],"refresh_graph"),e.jsx(Me,{},`k-${a}`)}export{mt as Component};
