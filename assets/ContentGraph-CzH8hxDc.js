import{r as t,j as S,a1 as W,a2 as A,R as w,g as $}from"./index-ChHXuf40.js";import{G as q}from"./Graph-BKYc9IKD.js";import{b as B}from"./content-CTNkBplU.js";import{p as F,q as H,r as U,t as X}from"./settingsState-D7smp1AL.js";import{a as J}from"./graph-Lys3-WEU.js";import{a as K}from"./events-DLU3_18Y.js";import"./colours.module-BoWwueDy.js";import"./string-CFFdVFMV.js";import"./FileSaver.min-D29rPHm2.js";import"./svgToPNG-Ltd00H6X.js";import"./ProgressDialog-CeFbeIBT.js";import"./DialogContent-_GwcI3J5.js";import"./createSimplePaletteValueFilter-CLdyqM5U.js";import"./Portal-BpkAKKpt.js";import"./Modal-DQ9h7Q_m.js";import"./IconButton-BXLcq7Mr.js";import"./useSlot-BVU38s2u.js";import"./DialogTitle-DRIas77U.js";import"./Typography-8VlALfQ4.js";import"./index-BfNLg11A.js";import"./LinearProgress-li3lTmA_.js";const O="_group_1yuy7_3",Q="_outerCircle_1yuy7_3",V="_disabledGroup_1yuy7_9 _group_1yuy7_3",Y="_selectedCircle_1yuy7_20",z="_selectedLink_1yuy7_42",x={group:O,outerCircle:Q,disabledGroup:V,selectedCircle:Y,selectedLink:z};function ee({id:n,selected:s,disabled:a,size:o}){const d=t.useRef(null),c=B(n);return S.jsxs("g",{className:a?x.disabledGroup:x.group,ref:d,"data-testid":`topic-node-${n}`,children:[S.jsx("circle",{className:s?x.selectedCircle:x.outerCircle,"data-testid":"profile-selected",r:s?o+35:o+30}),S.jsx("circle",{"data-testid":"profile-circle",r:o,fill:"white",stroke:"#0A869A",strokeWidth:10,"data-nodeitem":!0}),S.jsx("image",{href:c,width:o,height:o,x:-o/2,y:-o/2,preserveAspectRatio:"none",clipPath:"inset(0% round 20px)"})]})}function G(n,s){return n.getRelated("coengaged",s,{count:10})}function te(n){const s=t.useRef(new Map),[a,o]=t.useReducer(u=>++u,0),d=W(),c=A();return t.useEffect(()=>{n.forEach(u=>{const p=G(c,u);let l=0,i=1e6;p.forEach(g=>{l=Math.max(l,g.weight),i=Math.min(i,g.weight)}),s.current.set(u,{nodes:p,maxSimilarity:l,minSimilarity:i})}),o()},[n,c]),t.useEffect(()=>{const u=p=>{const l=G(c,p);let i=0,g=1e6;l.forEach(h=>{i=Math.max(i,h.weight),g=Math.min(g,h.weight)}),s.current.set(p,{nodes:l,maxSimilarity:i,minSimilarity:g}),o()};return d.on("edgetype-coengaged",u),()=>{d.off("edgetype-coengaged",u)}},[c,d]),t.useMemo(()=>({similar:s.current}),[a])}const v=.02,se=50,oe=400,ne=200;function ie(n,s){const o=n.getRelated("engaged",s,{count:10,timeDecay:.1,period:36e5}).reduce((d,c)=>d+c.weight,0);return Math.min(oe,o*ne)+se}function re(){const[n,s]=t.useState([]),[a,o]=t.useState([]),d=w(F),c=w(H),u=w(U),p=w(X),l=J("content"),i=$(),g=A(),h=te(l),[M,N]=t.useState(),[I,E]=t.useState(5),[D,Z]=t.useState(),[P,R]=t.useState(),L=t.useCallback(()=>{const e=l.filter(r=>{const m=h.similar.get(r);return((m==null?void 0:m.maxSimilarity)||0)>v});e.sort((r,m)=>{var y,k;return(((y=i.getContentStats(m))==null?void 0:y.engagement)||0)-(((k=i.getContentStats(r))==null?void 0:k.engagement)||0)});const C=e.slice(0,Math.max(20,Math.floor(.4*e.length))).map(r=>({id:r,label:r,size:ie(g,r)}));o(C);const _=[];e.forEach(r=>{const m=h.similar.get(r);if(m){const y=m.maxSimilarity;if(y<=v)return;const k=m.nodes.reduce((f,T)=>{var j;return Math.max(f,((j=h.similar.get(T.id))==null?void 0:j.maxSimilarity)||0)},0),b=Math.max(k,y);m.nodes.forEach(f=>{f.weight>(1-p)*y&&r!==f.id&&_.push({source:r,target:f.id,strength:f.weight/b,actualStrength:f.weight/b})})}}),s(_)},[l,h,p,i,g]);return t.useEffect(()=>{L()},[L]),S.jsx(q,{links:n,nodes:a,linkScale:d,linkStyles:P,charge:u,showLines:c,onSelect:e=>{M||E(2);const C=new Map;C.set(e.id,{className:x.selectedLink,width:_=>1+Math.floor(_.strength*_.strength*60)}),R(C),Z([e.x||0,e.y||0]),N(e.id)},onUnselect:()=>{N(void 0),R(void 0),E(5)},focusNode:M,zoom:I,center:D,defaultLinkStyle:{className:x.link,opacity:e=>e.strength*.8+.2,width:e=>5+Math.floor(e.strength*80)},children:a.map(e=>S.jsx(ee,{id:e.id,size:e.size,selected:e.id===M,disabled:!1},e.id))})}function Le(){const[n,s]=t.useReducer(a=>++a,0);return K(()=>{s()},[],"refresh_graph"),S.jsx(re,{},`k-${n}`)}export{Le as Component};
