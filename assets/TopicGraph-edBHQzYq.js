import{r as t,j as f,a5 as M,R as S,a2 as B}from"./index-ChHXuf40.js";import{G as A}from"./Graph-BKYc9IKD.js";import{y as b,z as G,A as v,B as D}from"./settingsState-D7smp1AL.js";import{a as U}from"./graph-Lys3-WEU.js";import{a as q}from"./events-DLU3_18Y.js";import"./colours.module-BoWwueDy.js";import"./string-CFFdVFMV.js";import"./FileSaver.min-D29rPHm2.js";import"./svgToPNG-Ltd00H6X.js";import"./ProgressDialog-CeFbeIBT.js";import"./DialogContent-_GwcI3J5.js";import"./createSimplePaletteValueFilter-CLdyqM5U.js";import"./Portal-BpkAKKpt.js";import"./Modal-DQ9h7Q_m.js";import"./IconButton-BXLcq7Mr.js";import"./useSlot-BVU38s2u.js";import"./DialogTitle-DRIas77U.js";import"./Typography-8VlALfQ4.js";import"./index-BfNLg11A.js";import"./LinearProgress-li3lTmA_.js";const F="_group_1wpop_3",P="_outerCircle_1wpop_3",W="_selectedCircle_1wpop_15",y={group:F,outerCircle:P,selectedCircle:W};function Z({id:i,selected:a,onResize:o}){const u=t.useRef(null),[l,g]=t.useState(100),c=l;return t.useEffect(()=>{if(u.current){const n=u.current.querySelector("text"),x=n&&n.getBBox?n.getBBox():null;if(x){const m=Math.floor(x.width/2+30);g(m),o(i,m)}}},[i,o]),f.jsxs("g",{className:y.group,ref:u,"data-testid":"topic-node",children:[f.jsx("circle",{className:a?y.selectedCircle:y.outerCircle,"data-testid":"profile-selected",r:a?c+20:c}),f.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r:c,fill:"white",stroke:"#0A869A",strokeWidth:10}),f.jsx("text",{y:0,x:0,fontSize:"40px",dominantBaseline:"middle",textAnchor:"middle",children:M(i)})]})}function $(i,a){const o=new Map;return i.getRelated("topic",a,{count:10}).forEach(l=>{i.getRelated("topic",l.id,{count:10}).forEach(c=>{const n=l.weight*c.weight;n>0&&o.set(c.id,(o.get(c.id)||0)+n)})}),Array.from(o).map(([l,g])=>({id:l,weight:g}))}function H(){const[i,a]=t.useState([]),o=t.useRef(new Map),[u,l]=t.useState([]),g=S(b),c=S(G),n=S(v),x=S(D),m=U("topic"),R=B(),C=t.useMemo(()=>{const e=new Map;return m.forEach(p=>{var d;const h=$(R,p);h.sort((r,L)=>L.weight-r.weight);const s=((d=h[0])==null?void 0:d.weight)||0;e.set(p,h.filter(r=>r.weight>=(1-n)*s))}),e},[m,n,R]),[k,_]=t.useState(),[N,E]=t.useState(5),[T,z]=t.useState(),w=t.useCallback(()=>{const e=m.filter(s=>{var d;return(((d=C.get(s))==null?void 0:d.length)||0)>0});l(e.map(s=>({id:s,size:o.current.get(s)||20})));const p=[];let h=0;e.forEach(s=>{const d=C.get(s);d&&d.forEach(r=>{r.weight>0&&s!==r.id&&(p.push({source:s,target:r.id,strength:r.weight,actualStrength:r.weight}),h=Math.max(h,r.weight))})}),p.forEach(s=>{s.strength/=h}),a(p)},[m,C]),j=t.useCallback((e,p)=>{o.current.set(e,p),w()},[w]);return t.useEffect(()=>{w()},[w]),f.jsx(A,{links:i,nodes:u,linkScale:g,charge:x,showLines:c,onSelect:e=>{k||E(3),z([e.x||0,e.y||0]),_(e.id)},onUnselect:()=>{_(void 0),E(5),z([0,0])},focusNode:k,zoom:N,center:T,defaultLinkStyle:{opacity:e=>e.strength*.9,width:e=>1+Math.floor(e.strength*60)},children:u.map(e=>f.jsx(Z,{id:e.id,selected:e.id===k,onResize:j},e.id))})}function ue(){const[i,a]=t.useReducer(o=>++o,0);return q(()=>{a()},[],"refresh_graph"),f.jsx(H,{},`k-${i}`)}export{ue as Component};
