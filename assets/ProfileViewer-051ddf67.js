import{b as C,R as S,r as l,m as I,j as e,t as R,l as N,u as w,v as L,O as k}from"./index-02b2945e.js";import{E as A}from"./ErrorDialog-dea2f05b.js";import{f as V}from"./random-67c94df7.js";import{B as y}from"./BlockDialog-2f32a60e.js";import{I as O,V as U}from"./peer-d87849a6.js";import{c as T}from"./sessionState-6915fb12.js";import{a as z}from"./configState-6be3aa1d.js";import{L as b}from"./logger-fbaa4ff5.js";import{C as D}from"./ContentLoader-dd766616.js";import{Q as B,P as Y}from"./Person-411c868c.js";import{I as F}from"./ImageSearch-6df1d0d1.js";import{I as _}from"./IconButton-02bc1303.js";import"./errorState-b147a579.js";import"./Close-50ef3ec2.js";import"./DialogContent-d100c3e0.js";import"./createSimplePaletteValueFilter-b2e05aa4.js";import"./Portal-a2b43acb.js";import"./Modal-2fc077e7.js";import"./useSlot-050d423d.js";import"./DialogTitle-3bd65ba4.js";import"./Typography-0738e1b3.js";import"./index-720786c4.js";import"./settings-1d1f0ea7.js";import"./menuState-2ff024b1.js";import"./settingsState-c28045a5.js";import"./lz-string-35001fa0.js";import"./localiser-c0c9a31b.js";import"./LinearProgress-51654afb.js";const K="#dee4e8",M="_container_1mw2h_3",Q="_pageContainer_1mw2h_16",$="_userContainer_1mw2h_42",q="_lang_1mw2h_50",G="_navOuter_1mw2h_56",H="_appNav_1mw2h_64",J="_connectionStatus_1mw2h_72",u={backgroundLight:K,container:M,pageContainer:Q,userContainer:$,lang:q,navOuter:G,appNav:H,connectionStatus:J},W="genai_somekone_username";function X({server:n,mycode:r,children:s,onID:a}){const f=C(z),i=S(T),[h,E]=l.useState(),[v,P]=l.useState(!1),{profiler:t,recommender:d,actionLog:g}=I(),x=l.useCallback(o=>{if(o.event==="eter:reguser"){try{t.createUserProfile(o.id,o.username)}catch(p){console.warn(p)}a(o.id)}else if(o.event==="eter:profile_data")try{t.replaceProfile(o.id,o.profile)}catch{}else o.event==="eter:action_log"?g.appendActionLog(o.log,o.id):o.event==="eter:recommendations"?d.appendRecommendations(o.id,o.recommendations):o.event==="eter:config"&&(f(p=>({...p,...o.configuration})),o.content&&E(o.content))},[f,a,t,g,d]),{ready:c,send:m,peer:j}=O({host:{}.VITE_APP_PEER_SERVER,secure:{}.VITE_APP_PEER_SECURE==="1",key:{}.VITE_APP_PEER_KEY||"peerjs",port:{}.VITE_APP_PEER_PORT?parseInt({}.VITE_APP_PEER_PORT):443,code:n&&`sm-${r}`,server:`sm-${n}`,onData:x});return l.useEffect(()=>{if(i&&m&&c){try{window.sessionStorage.setItem(W,i)}catch{}t.setUserName(t.getCurrentUser(),i),m({event:"eter:reguser",username:i,id:t.getCurrentUser()})}},[i,m,c,t]),e.jsxs(e.Fragment,{children:[c&&v&&e.jsx(b,{sender:m,children:s}),e.jsx(D,{content:h,onLoaded:()=>P(!0),noSession:!0}),e.jsx("div",{className:u.connectionStatus,children:e.jsx(U,{api:{}.VITE_APP_APIURL,appName:"somekone",ready:c,peer:j,visibility:0})})]})}function Z(){const n=R(),r=N(),s=n.pathname.split("/").pop();return e.jsx("div",{className:u.navOuter,children:e.jsxs("nav",{className:u.appNav,"data-testid":"app-nav",children:[e.jsx(_,{color:"inherit",size:"large",onClick:()=>r("data",{replace:!0}),children:e.jsx(B,{fontSize:"inherit"})}),e.jsx(_,{color:"inherit",size:"large",onClick:()=>r("profile",{replace:s!=="data"}),children:e.jsx(Y,{fontSize:"inherit"})}),e.jsx(_,{color:"inherit",size:"large",onClick:()=>r("recommendations",{replace:s!=="data"}),children:e.jsx(F,{fontSize:"inherit"})})]})})}function we(){const{code:n}=w(),r=V(10),s=L();return e.jsxs(e.Fragment,{children:[e.jsxs(X,{server:n,mycode:r,onID:a=>{s.setUser(a)},children:[e.jsxs("div",{className:u.container,children:[e.jsx(k,{}),e.jsx(Z,{}),e.jsx(y,{})]}),e.jsx("span",{})]}),e.jsx(A,{})]})}export{we as Component};
