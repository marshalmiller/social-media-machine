import{l as x,j as n,a9 as _,r as f,c as j,v as C,I as b}from"./index-ChHXuf40.js";import{C as v}from"./CheckCircle-CXj5CTlc.js";import{C as B}from"./colours-yJq7kSUE.js";const w="_userSection_1rhop_3",y="_placeholderImage_1rhop_56",I="_selectButton_1rhop_63",U="_selectedButton_1rhop_73 _selectButton_1rhop_63",m={userSection:w,placeholderImage:y,selectButton:I,selectedButton:U};function p({selected:e}){return n.jsx("div",{className:e?m.selectedButton:m.selectButton,children:e&&n.jsx(v,{color:"inherit"})})}function z({id:e,onSelect:s,colour:i,selected:r,multiple:c}){const{content:l,profiler:u}=x(),t=u.getUserData(e);return n.jsx("li",{children:n.jsxs("button",{onClick:s,"aria-label":(t==null?void 0:t.name)||"Missing name",children:[t!=null&&t.image?n.jsx("img",{src:l.getContentData(t.image),alt:"",width:50,height:50,style:{borderColor:i||"#444"}}):n.jsx("div",{className:m.placeholderImage}),t==null?void 0:t.name,n.jsx("div",{style:{flexGrow:1}}),c&&n.jsx(p,{selected:r})]})})}const E=new B;function D(e){return E.get(e)}function k(){const e=_(),[s,i]=f.useState(()=>({similar:e.getSimilar(),users:e.getUsers(),clusters:e.getClusters()}));return f.useEffect(()=>{const r=()=>{i({similar:e.getSimilar(),users:e.getUsers(),clusters:e.getClusters()})};return e.on("updated",r),()=>{e.off("updated",r)}},[e]),s}function L(e,s,i,r){const c=[],l=new Set,u=i.get(e);u&&u.forEach(a=>{c.push(a.id),l.add(a.id)});const t=[...s];return t.sort((a,g)=>{var o,d;return(((o=r==null?void 0:r.get(a))==null?void 0:o.label)||"zz").localeCompare(((d=r==null?void 0:r.get(g))==null?void 0:d.label)||"zz")}),t.forEach(a=>{l.has(a)||c.push(a)}),c}function M({onSelect:e,multiple:s,preSelected:i}){const{t:r}=j(),c=k(),l=c.users,u=C(),[t,a]=f.useState(new Set),g=L(u.getCurrentUser(),l,c.similar,c.clusters);return f.useEffect(()=>{i&&a(new Set(i))},[i]),n.jsxs("div",{className:m.userSection,children:[n.jsx("ul",{children:g.map(o=>{var d;return n.jsx(z,{id:o,multiple:!!s,onSelect:()=>{s===!0||s&&s>1?a(S=>{const h=new Set(S);return h.has(o)?h.delete(o):(s===!0||s>h.size)&&h.add(o),h}):e([o])},selected:t==null?void 0:t.has(o),colour:D(((d=c.clusters.get(o))==null?void 0:d.label)||"nocluster")},o)})}),(s===!0||s&&s>1)&&n.jsx(b,{disabled:t.size===0,onClick:()=>e(Array.from(t)),variant:"contained",color:"primary","data-testid":"user-select-button",children:r("dashboard.actions.select")})]})}export{M as U,D as c,k as u};
