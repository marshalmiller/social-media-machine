import{r as i,j as e,l as C,p as R,v as _,c as L,b as I,M as W,R as j}from"./index-ChHXuf40.js";import{e as U,g as z,s as k,S as H,W as b}from"./Widget-BzWguO2D.js";import{n as N}from"./menuState-BrKGn-Zy.js";import{P as T}from"./DataProfile-BB0Cy9-2.js";import{P as F}from"./UserProfile-Ba6IyhZ1.js";import{M as D,R as O}from"./RecommendationsHeatmap-CFho8frj.js";import{G as $}from"./Graph-BKYc9IKD.js";import{L as A}from"./Label-ByPLvDgY.js";import{c as G}from"./colours.module-BoWwueDy.js";import{u as B}from"./profiler-BgoGrxGa.js";import{u as K,c as P}from"./UserListing-Da09B9Tx.js";import{g as Z}from"./links-0NEn5SMw.js";import{c as q}from"./configState-BS87aI9Z.js";import{C as J}from"./CheckCircle-CXj5CTlc.js";import{c as Q,I as E}from"./IconButton-BXLcq7Mr.js";import{F as V}from"./Feed-C9lRbnqo.js";import{M as X}from"./Menu-Jp_098nt.js";import{U as Y}from"./UserDialog-Di7LZn7A.js";import{I as M}from"./I18nextProvider-oW3AECIJ.js";import{M as ee}from"./TextField-MaMPnnBO.js";import{M as te}from"./MenuItem-C3-73DVz.js";import{R as se}from"./Refresh-CxoqocOo.js";function re({children:r,connections:x}){const[o,m]=i.useState([]),l=i.useRef(null),a=i.useRef();return i.useEffect(()=>{if(l.current){a.current=new ResizeObserver(()=>{if(l.current){const s=U(l.current);m(z(s,x))}}),a.current.observe(l.current);const d=l.current.children;if(d)for(let s=0;s<d.length;++s){const c=d[s];a.current.observe(c)}return()=>{var s;(s=a.current)==null||s.disconnect()}}},[x]),e.jsx("div",{className:k.workspace,children:e.jsxs("div",{className:k.container,ref:l,style:{gridTemplateColumns:`repeat(${Array.isArray(r)?r.filter(d=>!!d).length:1}, max-content)`},children:[e.jsx(H,{lines:o}),r]})})}const y={},v=5,oe=i.memo(function({disabled:x,node:o}){var f,h,p,S;const{content:m,profiler:l}=C(),[a,d]=i.useState(!1),s=o.size,c=l.getUserData(o.id),t=c==null?void 0:c.image,n=c==null?void 0:c.name,g=(f=o.data)==null?void 0:f.alwaysShowLabel,u=n&&(g||a);return e.jsxs("g",{className:x?y.disabledGroup:y.group,onPointerEnter:()=>d(!0),onPointerLeave:()=>d(!1),"data-testid":o.id,children:[e.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r:s,fill:t&&t.length>0?"white":((h=o.data)==null?void 0:h.colour)||"#5f7377",stroke:((p=o.data)==null?void 0:p.colour)||"#5f7377",strokeWidth:v}),t&&t.length>0&&e.jsx("image",{x:-s,y:-s,width:s*2,height:s*2,href:m.getContentData(t,!0),preserveAspectRatio:"none",clipPath:`circle(${s-v}px)`}),u&&e.jsx(A,{label:n,x:0,y:s+30,scale:n.length<20?2.5:2,padding:5,fill:((S=o.data)==null?void 0:S.colour)||"#5f7377",color:"white"})]})}),ne=20,ie=5;function ae({userId:r}){var c;const x=B(r),o=K(),[m,l]=i.useState([]),[a,d]=i.useState([]),s=((c=o.clusters.get(r))==null?void 0:c.label)||"none";return i.useEffect(()=>{const t=o.similar.get(r);if(!t)return;const n=t;if(!n)return;const g=[...n.map(h=>({id:h.id,size:50,data:{colour:P(s)}})),{id:r,size:50,data:{alwaysShowLabel:!0,colour:P(s)}}];l(g);const u=new Map;u.set(r,t),n.forEach(h=>{const p=o.similar.get(h.id);p&&u.set(h.id,p)});const f=Z(u,!1,.3,4);d(f)},[o,x,r,s]),e.jsx($,{links:a,nodes:m,linkScale:1.2,defaultLinkStyle:{opacity:t=>t.target.fx!==void 0?.6:.1,width:t=>ie+Math.floor(t.strength*ne),colour:t=>t.target.fx!==void 0?G.secondary:"#444"},charge:.5,showLines:!0,zoom:.8,center:[0,0],disableControls:!0,disableCenter:!1,autoCamera:!0,children:m.map(t=>e.jsx(oe,{id:t.id,node:t,onResize:()=>{}},t.id))})}const ce="_widgetColumn_1r491_1",le="_bbcontainer_1r491_7",de="_bbtick_1r491_14",w={widgetColumn:ce,bbcontainer:le,bbtick:de},me=Q(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M7 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"Pending");function ue({spin:r}){return e.jsx(b,{dataWidget:"blackbox",children:e.jsxs("div",{className:w.bbcontainer,children:[e.jsx(R,{disabled:!r}),e.jsxs("div",{className:w.bbtick,children:[!r&&e.jsx(J,{color:"primary",fontSize:"large"}),r&&e.jsx(me,{color:"disabled",fontSize:"large"})]})]})})}function fe({id:r,onProfile:x,onRecommend:o,onLog:m,hideMenu:l}){const d=_().getUserName(r),s=i.useRef(null),{t:c}=L(),[t,n]=i.useState(!1),[g,u]=i.useState(!1),f=I(N);return e.jsxs(b,{title:d,dataWidget:"feed",style:{width:"400px"},contentStyle:{height:"600px"},noPadding:!0,menu:l?void 0:e.jsxs("div",{children:[e.jsx(E,{ref:s,onClick:()=>n(!0),children:e.jsx(X,{})}),e.jsx(ee,{anchorEl:s.current,open:t,onClose:()=>n(!1),children:e.jsx(te,{onClick:()=>{u(!0),n(!1)},children:c("workflow.actions.selectUser")})})]}),children:[e.jsx(M,{i18n:W,defaultNS:"dashboard",children:e.jsx(Y,{open:g,onClose:()=>u(!1),onSelect:h=>f(h[0])})}),e.jsx(V,{id:r,noHeader:!0,alwaysActive:!0,onProfile:x,onRecommend:o,onLog:m,noPadding:!0})]})}const he=[{start:"feed",end:"data",startPoint:"right",endPoint:"left"},{start:"feed",end:"blackbox",startPoint:"right",endPoint:"left"},{start:"blackbox",end:"recommendations",startPoint:"right",endPoint:"left"},{start:"data",end:"profile",startPoint:"right",endPoint:"left"},{start:"profile",end:"cluster",startPoint:"bottom",endPoint:"top"},{start:"profile",end:"recommendations",startPoint:"right",endPoint:"left"},{start:"cluster",end:"recommendations",startPoint:"right",endPoint:"left"}];function He({id:r,onProfile:x,onRecommend:o,onLog:m,hideFeedMenu:l}){const{t:a}=L("common"),d=j(N),{profiler:s,content:c}=C(),t=r||d||s.getCurrentUser(),n=j(q(t||"user:")),[g,u]=i.useState(!1),f=i.useRef();f.current||(f.current=new D(c,{dataSetSize:1,dim:20}));const h=i.useCallback(()=>{m&&m(),u(!0)},[m]);return i.useEffect(()=>{if(g){const p=setTimeout(()=>u(!1),1e3);return()=>{clearTimeout(p)}}},[g]),e.jsx(M,{i18n:W,defaultNS:"common",children:e.jsxs(re,{connections:he,children:[!n.hideFeedInWorkflow&&e.jsx(fe,{id:t,onProfile:x,onRecommend:o,onLog:h,hideMenu:l}),!n.hideFeedInWorkflow&&n.blackboxWorkflow&&e.jsx(ue,{spin:g}),!n.blackboxWorkflow&&e.jsx(b,{title:a("workflow.titles.data"),dataWidget:"data",style:{maxWidth:"350px"},contentStyle:{maxHeight:"600px"},noPadding:!0,children:e.jsx(T,{id:t,disableMenu:!0,noImageCloud:!0})}),!n.blackboxWorkflow&&e.jsxs("div",{"data-widget":"container",className:w.widgetColumn,children:[e.jsx(b,{title:a("workflow.titles.profile"),dataWidget:"profile",style:{maxWidth:"350px"},contentStyle:{maxHeight:"600px"},noPadding:!0,children:e.jsx(F,{id:t,disableMenu:!0,noTagSummary:!0})}),e.jsx(b,{title:a("workflow.titles.cluster"),dataWidget:"cluster",style:{maxWidth:"350px"},contentStyle:{maxHeight:"400px"},noPadding:!0,children:t&&e.jsx("div",{style:{position:"relative",width:"300px",height:"300px"},children:e.jsx(ae,{userId:t})})})]}),e.jsx(b,{title:a("workflow.titles.map"),dataWidget:"recommendations",style:{width:"600px"},contentStyle:{height:"600px"},noPadding:!0,menu:e.jsx("div",{children:e.jsx(E,{onClick:()=>{var p;return(p=f.current)==null?void 0:p.refresh()},"aria-label":a("workflow.actions.refresh"),children:e.jsx(se,{})})}),children:t&&e.jsx(O,{user:t,dimensions:20,deviationFactor:2,mapService:f.current})})]})})}export{He as W};
