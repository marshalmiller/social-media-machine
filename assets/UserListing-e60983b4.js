import{m as S,j as n,aa as j,r as m,c as C,v as b,I as v}from"./index-02b2945e.js";import{s as g}from"./style.module-fd5d79c8.js";import{C as w}from"./CheckCircle-b71d1d84.js";import{C as y}from"./colours-9cdd3933.js";function U({selected:e}){return n.jsx("div",{className:e?g.selectedButton:g.selectButton,children:e&&n.jsx(w,{color:"inherit"})})}function z({id:e,onSelect:t,colour:c,selected:r,multiple:o}){const{content:l,profiler:u}=S(),s=u.getUserData(e);return n.jsx("li",{children:n.jsxs("button",{onClick:t,"aria-label":(s==null?void 0:s.name)||"Missing name",children:[s!=null&&s.image?n.jsx("img",{src:l.getContentData(s.image),alt:"",width:50,height:50,style:{borderColor:c||"#444"}}):n.jsx("div",{className:g.placeholderImage}),s==null?void 0:s.name,n.jsx("div",{style:{flexGrow:1}}),o&&n.jsx(U,{selected:r})]})})}const E=new y;function D(e){return E.get(e)}function I(){const e=j(),[t,c]=m.useState(()=>({similar:e.getSimilar(),users:e.getUsers(),clusters:e.getClusters()}));return m.useEffect(()=>{const r=()=>{c({similar:e.getSimilar(),users:e.getUsers(),clusters:e.getClusters()})};return e.on("updated",r),()=>{e.off("updated",r)}},[e]),t}function k(e,t,c,r){const o=[],l=new Set,u=c.get(e);u&&u.forEach(i=>{o.push(i.id),l.add(i.id)});const s=[...t];return s.sort((i,h)=>{var a,d;return(((a=r==null?void 0:r.get(i))==null?void 0:a.label)||"zz").localeCompare(((d=r==null?void 0:r.get(h))==null?void 0:d.label)||"zz")}),s.forEach(i=>{l.has(i)||o.push(i)}),o}function G({onSelect:e,multiple:t,preSelected:c}){const{t:r}=C(),o=I(),l=o.users,u=b(),[s,i]=m.useState(new Set),h=k(u.getCurrentUser(),l,o.similar,o.clusters);return m.useEffect(()=>{c&&i(new Set(c))},[c]),n.jsxs("div",{className:g.userSection,children:[n.jsx("ul",{children:h.map(a=>{var d;return n.jsx(z,{id:a,multiple:!!t,onSelect:()=>{t===!0||t&&t>1?i(x=>{const f=new Set(x);return f.has(a)?f.delete(a):(t===!0||t>f.size)&&f.add(a),f}):e([a])},selected:s==null?void 0:s.has(a),colour:D(((d=o.clusters.get(a))==null?void 0:d.label)||"nocluster")},a)})}),(t===!0||t&&t>1)&&n.jsx(v,{disabled:s.size===0,onClick:()=>e(Array.from(s)),variant:"contained",color:"primary","data-testid":"user-select-button",children:r("dashboard.actions.select")})]})}export{G as U,D as c,I as u};
