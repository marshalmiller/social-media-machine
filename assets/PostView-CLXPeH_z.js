import{c as O,r as s,j as n,D as U,e as q,Q as H,J,X as Q,d as Y,B as K,k as V,f as X,s as G,o as Z,g as ee,p as te,h as ae,i as ne,b as re}from"./index-ChHXuf40.js";import{f as ie,A as se}from"./Add-BDAM07Vu.js";import{I as N,c as oe}from"./IconButton-BXLcq7Mr.js";import{u as ce}from"./profiler-BgoGrxGa.js";import{C as le}from"./Close-Dh1l5TZE.js";import{C as T}from"./Chip-BlC7IdM3.js";import{v as ue}from"./v4-BKT09osN.js";import{u as de}from"./uiState-D0gkpRWk.js";import{V as he}from"./ViewContainer-Dnv2NFVH.js";import"./createSimplePaletteValueFilter-CLdyqM5U.js";var me=Object.defineProperty,pe=(t,e,a)=>e in t?me(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,k=(t,e,a)=>pe(t,typeof e!="symbol"?e+"":e,a);/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I={facingMode:"user",frameRate:24},fe=t=>(t.facingMode=t.facingMode||I.facingMode,t.frameRate=t.frameRate||I.frameRate,t.aspectRatio=t.aspectRatio||I.aspectRatio,t);class ve{constructor(e=400,a=400,r=!1){k(this,"flip"),k(this,"width"),k(this,"height"),k(this,"webcam"),k(this,"canvas"),this.width=e,this.height=a,this.flip=r}getWebcam(e={}){if(!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)return Promise.reject("Your browser does not support WebRTC. Please try another one.");e.width=640;const a=fe(e),r=document.createElement("video");return window.navigator.mediaDevices.getUserMedia({video:a}).then(c=>(r.srcObject=c,r.addEventListener("loadedmetadata",()=>{const{videoWidth:o,videoHeight:u}=r;r.width=o,r.height=u}),r),()=>Promise.reject("Could not open your camera. You may have denied access."))}async setup(e={}){this.webcam||(this.webcam=await this.getWebcam(e),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height))}play(){var e;return(e=this.webcam)==null?void 0:e.play()}pause(){var e;(e=this.webcam)==null||e.pause()}stop(){this.webcam&&this.stopStreamedVideo(this.webcam)}update(){this.renderCameraToCanvas()}stopStreamedVideo(e){e.srcObject.getTracks().forEach(a=>{a.stop()}),e.srcObject=null}renderCameraToCanvas(){this.canvas&&this.webcam&&this.canvas.getContext("2d")&&this.webcam.videoWidth!==0&&ie(this.webcam,this.width,this.flip,this.canvas)}}function be(t){return String(t).match(/[\d.\-+]*\s*(.*)/)[1]||""}function ge(t){return parseFloat(t)}const Ce="_container_u6uf5_1",we="_wrapContainer_u6uf5_5",xe="_flipButton_u6uf5_10",z={container:Ce,wrapContainer:we,flipButton:xe};function _e(t){return Z("MuiSkeleton",t)}K("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const ye=t=>{const{classes:e,variant:a,animation:r,hasChildren:c,width:o,height:u}=t;return Q({root:["root",a,r,c&&"withChildren",c&&!o&&"fitContent",c&&!u&&"heightAuto"]},_e,e)},D=V`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`,A=V`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`,je=typeof D!="string"?X`
        animation: ${D} 2s ease-in-out 0.5s infinite;
      `:null,ke=typeof A!="string"?X`
        &::after {
          animation: ${A} 2s linear 0.5s infinite;
        }
      `:null,Re=H("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.root,e[a.variant],a.animation!==!1&&e[a.animation],a.hasChildren&&e.withChildren,a.hasChildren&&!a.width&&e.fitContent,a.hasChildren&&!a.height&&e.heightAuto]}})(Y(({theme:t})=>{const e=be(t.shape.borderRadius)||"px",a=ge(t.shape.borderRadius);return{display:"block",backgroundColor:t.vars?t.vars.palette.Skeleton.bg:G(t.palette.text.primary,t.palette.mode==="light"?.11:.13),height:"1.2em",variants:[{props:{variant:"text"},style:{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${a}${e}/${Math.round(a/.6*10)/10}${e}`,"&:empty:before":{content:'"\\00a0"'}}},{props:{variant:"circular"},style:{borderRadius:"50%"}},{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:({ownerState:r})=>r.hasChildren,style:{"& > *":{visibility:"hidden"}}},{props:({ownerState:r})=>r.hasChildren&&!r.width,style:{maxWidth:"fit-content"}},{props:({ownerState:r})=>r.hasChildren&&!r.height,style:{height:"auto"}},{props:{animation:"pulse"},style:je||{animation:`${D} 2s ease-in-out 0.5s infinite`}},{props:{animation:"wave"},style:{position:"relative",overflow:"hidden",WebkitMaskImage:"-webkit-radial-gradient(white, black)","&::after":{background:`linear-gradient(
                90deg,
                transparent,
                ${(t.vars||t).palette.action.hover},
                transparent
              )`,content:'""',position:"absolute",transform:"translateX(-100%)",bottom:0,left:0,right:0,top:0}}},{props:{animation:"wave"},style:ke||{"&::after":{animation:`${A} 2s linear 0.5s infinite`}}}]}})),Se=s.forwardRef(function(t,e){const a=q({props:t,name:"MuiSkeleton"}),{animation:r="pulse",className:c,component:o="span",height:u,style:w,variant:p="text",width:_,...d}=a,g={...a,animation:r,component:o,variant:p,hasChildren:!!d.children},i=ye(g);return n.jsx(Re,{as:o,ref:e,className:J(i.root,c),ownerState:g,...d,style:{width:_,height:u,...w}})}),W=U([n.jsx("path",{d:"M16 7h-1l-1-1h-4L9 7H8c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2m-4 7c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"},"0"),n.jsx("path",{d:"m8.57.51 4.48 4.48V2.04c4.72.47 8.48 4.23 8.95 8.95h2C23.34 3.02 15.49-1.59 8.57.51m2.38 21.45c-4.72-.47-8.48-4.23-8.95-8.95H0c.66 7.97 8.51 12.58 15.43 10.48l-4.48-4.48z"},"1")],"Cameraswitch");function Me({interval:t,capture:e,onCapture:a,disable:r,direct:c,hidden:o,onPreprocess:u,onPostprocess:w,onActivated:p,onFatal:_,size:d}){const{t:g}=O(),[i,y]=s.useState(null),f=s.useRef(null),C=s.useRef(-1),h=s.useRef(0),m=s.useRef(),[x,E]=s.useState(!1),[R,$]=s.useState(!1);s.useEffect(()=>{m.current=async l=>{var v;if(r){m.current&&(C.current=window.requestAnimationFrame(m.current));return}if(i&&i.canvas){i.update();const j=t!==void 0?t:1e3;if(u&&await u(i.canvas),e&&a&&l-h.current>=j){if(c&&i.canvas)await a(i.canvas);else{const S=document.createElement("canvas");S.width=i.canvas.width,S.height=i.canvas.height;const B=S.getContext("2d");B||console.error("Failed to get context"),B==null||B.drawImage(i.canvas,0,0),await a(S)}h.current=l}w&&await w(i.canvas);const P=(v=f.current)==null?void 0:v.getContext("2d");P&&P.drawImage(i.canvas,0,0)}m.current&&(C.current=window.requestAnimationFrame(m.current))},C.current===-1&&(C.current=window.requestAnimationFrame(m.current))},[i,t,e,a,c,r,w,u]);const F=s.useCallback(async l=>{var v;if(await l.setup({facingMode:R?"user":"environment"}),l.webcam&&(l.webcam.playsInline=!0,l.webcam.muted=!0,l.webcam.onsuspend=()=>l.play(),y(l)),(v=navigator.mediaDevices)!=null&&v.enumerateDevices)try{(await navigator.mediaDevices.enumerateDevices()).filter(j=>j.kind==="videoinput").length>1&&(x||E(!0),l.flip=R)}catch(j){console.error(j)}return p&&p(!0),l},[p,R,x]);s.useEffect(()=>{e&&(h.current=0)},[e]),s.useEffect(()=>{const l=new ve(d,d,!0);return F(l).catch(v=>{p&&p(!1),console.error("No webcam",v),_&&_()}),()=>{var v;(v=l.webcam)!=null&&v.srcObject&&l.stop()}},[R,p,F,_,d]),s.useEffect(()=>()=>{var l;m.current=void 0,(l=i==null?void 0:i.webcam)!=null&&l.srcObject&&i.stop()},[i]),s.useEffect(()=>{i&&(r?i.pause():i.play())},[i,r]);const L=s.useCallback(()=>{$(l=>!l)},[$]);return o?n.jsx(n.Fragment,{children:x&&n.jsx(N,{size:"large",color:"inherit",onClick:L,"aria-label":g("webcam.aria.flip"),children:n.jsx(W,{fontSize:"large"})})}):n.jsxs(n.Fragment,{children:[!i&&n.jsx(Se,{variant:"rounded",width:d,height:d}),i&&n.jsxs("div",{className:z.wrapContainer,children:[x&&n.jsx(N,{className:z.flipButton,size:"large",color:"inherit",onClick:L,"aria-label":g("webcam.aria.flip"),children:n.jsx(W,{fontSize:"large"})}),n.jsx("div",{"data-testid":"webcam",className:z.container,role:"img","aria-label":g("webcam.aria.video"),children:n.jsx("canvas",{width:d,height:d,ref:f})})]})]})}const Ee="_container_1yi8z_3",Be="_darkContainer_1yi8z_15 _container_1yi8z_3",Ie="_outerContainer_1yi8z_20",ze="_webcamContainer_1yi8z_31",Ne="_imageContainer_1yi8z_38",De="_buttonContainer_1yi8z_44",Ae="_labelChips_1yi8z_52",Oe="_postButtonContainer_1yi8z_59",$e="_spinnerContainer_1yi8z_67",Fe="_topRightButtons_1yi8z_74",b={container:Ee,darkContainer:Be,outerContainer:Ie,webcamContainer:ze,imageContainer:Ne,buttonContainer:De,labelChips:Ae,postButtonContainer:Oe,spinnerContainer:$e,topRightButtons:Fe},Le="_recordButton_yfgga_1",Pe="_buttonCircleOuter_yfgga_8",Te="_buttonCircleInner_yfgga_20",We="_buttonCircleActive_yfgga_33 _buttonCircleInner_yfgga_20",M={recordButton:Le,buttonCircleOuter:Pe,buttonCircleInner:Te,buttonCircleActive:We};function Ve({capturing:t,onChange:e}){const a=s.useRef(null),r=s.useCallback(()=>e(!0),[e]),c=s.useCallback(u=>{u.cancelable&&(u.preventDefault(),u.stopImmediatePropagation(),e(!0))},[e]),o=s.useCallback(()=>e(!1),[e]);return s.useEffect(()=>{a.current&&(a.current.focus(),a.current.addEventListener("touchstart",c,{passive:!1}))},[a,c]),n.jsx("button",{className:M.recordButton,ref:a,onMouseDown:r,onMouseUp:o,onBlur:o,onMouseLeave:o,onTouchEnd:o,onTouchCancel:o,children:n.jsx("div",{className:M.buttonCircleOuter,children:n.jsx("div",{className:t?M.buttonCircleActive:M.buttonCircleInner})})})}function Xe({onImage:t}){const[e,a]=s.useState(!1),r=s.useCallback(c=>{a(!1),t(c.toDataURL("image/jpeg",.9))},[t]);return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:b.webcamContainer,children:n.jsx(Me,{size:512,onCapture:r,capture:e})}),n.jsx("div",{className:b.buttonContainer,children:n.jsx(Ve,{capturing:e,onChange:a})})]})}const Ue=oe(n.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"}),"Done");async function qe(t,e){return t.hasEncoder()||await t.createEncoderModel({noSave:!0}),t.getSimilarContent(e,20)}function He({image:t,onDone:e,onCancel:a}){const{t:r}=O(),c=ee(),[o,u]=s.useState(),[w,p]=s.useState(5),[_,d]=s.useState(),g=ce();return s.useEffect(()=>{c.createIsolatedEmbedding(t,[]).then(i=>{d(i),qe(c,i).then(y=>{const f=new Map;y.forEach(h=>{const m=c.getContentMetadata(h.id);m&&m.labels.forEach(x=>{const E=f.get(x.label)||{score:0};f.set(x.label,{score:E.score+h.weight,weight:x.weight})})});const C=Array.from(f);C.sort((h,m)=>m[1].score-h[1].score),u(C.map(h=>({label:h[0],score:h[1].score,weight:h[1].weight})))})}).catch(()=>{u([])})},[t,c]),n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:b.imageContainer,children:[n.jsx("img",{src:t,width:"100%",alt:""}),n.jsx("div",{className:b.topRightButtons,children:n.jsx(N,{color:"inherit",onClick:a,children:n.jsx(le,{fontSize:"large"})})})]}),o&&n.jsxs("div",{className:b.labelChips,children:[o.slice(0,w).map((i,y)=>n.jsx(T,{variant:"outlined",label:`#${i.label}`,onDelete:()=>{u(f=>(f||[]).filter(C=>C.label!==i.label)),p(f=>f-1)}},y)),n.jsx(T,{variant:"filled",color:"primary",label:r("profile.actions.more"),icon:n.jsx(se,{}),onClick:()=>p(i=>i+5)})]}),!o&&n.jsx("div",{className:b.spinnerContainer,children:n.jsx(te,{})}),n.jsx("div",{className:b.postButtonContainer,children:n.jsx(ae,{disabled:!o,startIcon:n.jsx(Ue,{fontSize:"large"}),variant:"contained",color:"secondary",onClick:()=>{c.postContent(t,{id:ue(),author:g.name,authorId:g.id,embedding:_,labels:(o==null?void 0:o.slice(0,w).map(i=>({label:i.label,weight:i.weight})))||[]}),e()},children:r("profile.actions.post")})})]})}function Je(){const t=ne(),e=re(de),[a,r]=s.useState();s.useEffect(()=>(e(!a),()=>e(!1)),[e,a]);const c=s.useCallback(()=>{t(-1)},[t]),o=s.useCallback(()=>{r(void 0)},[]);return n.jsx("div",{className:b.outerContainer,children:n.jsxs("div",{className:a?b.container:b.darkContainer,tabIndex:0,children:[a&&n.jsx(He,{image:a,onDone:c,onCancel:o}),!a&&n.jsx(Xe,{onImage:r})]})})}function it(){const{t}=O();return n.jsx(he,{title:t("profile.titles.newPost"),children:n.jsx(Je,{})})}export{it as Component};
