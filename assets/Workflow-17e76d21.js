import{r as l,j as e,m as N,h as E,v,c as C,b as _,R as S,M as L}from"./index-02b2945e.js";import{e as M,g as R,s as k,S as U,W as g}from"./Widget-faef6aca.js";import{n as W}from"./menuState-2ff024b1.js";import{P as I}from"./DataProfile-29b73b7e.js";import{P as z}from"./UserProfile-c3f95e1b.js";import{R as T}from"./RecommendationsHeatmap-cbbc4619.js";import{G as H}from"./Graph-d1b46b16.js";import{L as D}from"./Label-2d9d5124.js";import{c as F}from"./colours.module-29b309d0.js";import{u as O}from"./profiler-25e786d5.js";import{u as $,c as w}from"./UserListing-e60983b4.js";import{g as A}from"./links-8de2c7fc.js";import{c as G}from"./configState-6be3aa1d.js";import{C as B}from"./CheckCircle-b71d1d84.js";import{c as K,I as Z}from"./IconButton-02bc1303.js";import{F as q}from"./Feed-95058eca.js";import{M as J}from"./Menu-ad377c0c.js";import{U as Q}from"./UserDialog-78cd1933.js";import{M as V}from"./TextField-43fc95d4.js";import{M as X}from"./MenuItem-97c66a8d.js";import{I as Y}from"./I18nextProvider-f367c211.js";function ee({children:r,connections:u}){const[i,m]=l.useState([]),a=l.useRef(null),n=l.useRef();return l.useEffect(()=>{if(a.current){n.current=new ResizeObserver(()=>{if(a.current){const s=M(a.current);m(R(s,u))}}),n.current.observe(a.current);const d=a.current.children;if(d)for(let s=0;s<d.length;++s){const o=d[s];n.current.observe(o)}return()=>{var s;(s=n.current)==null||s.disconnect()}}},[u]),e.jsx("div",{className:k.workspace,children:e.jsxs("div",{className:k.container,ref:a,style:{gridTemplateColumns:`repeat(${Array.isArray(r)?r.length:1}, max-content)`},children:[e.jsx(U,{lines:i}),r]})})}const P={},y=5,te=l.memo(function({disabled:u,node:i}){var t,c,x,f;const{content:m,profiler:a}=N(),n=i.size,d=(t=i.data)==null?void 0:t.name,s=a.getUserData(i.id),o=s==null?void 0:s.image;return e.jsxs("g",{className:u?P.disabledGroup:P.group,children:[e.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r:n,fill:o&&o.length>0?"white":((c=i.data)==null?void 0:c.colour)||"#5f7377",stroke:((x=i.data)==null?void 0:x.colour)||"#5f7377",strokeWidth:y}),o&&o.length>0&&e.jsx("image",{x:-n,y:-n,width:n*2,height:n*2,href:m.getContentData(o,!0),preserveAspectRatio:"none",clipPath:`circle(${n-y}px)`}),d&&e.jsx(D,{label:d,x:0,y:n+30,scale:d.length<20?2.5:2,padding:5,fill:((f=i.data)==null?void 0:f.colour)||"#5f7377",color:"white"})]})}),se=20,oe=5;function re({userId:r}){var o;const u=O(r),i=$(),[m,a]=l.useState([]),[n,d]=l.useState([]),s=((o=i.clusters.get(r))==null?void 0:o.label)||"none";return l.useEffect(()=>{const t=i.similar.get(r);if(!t)return;const c=t;if(!c)return;const x=[...c.map(p=>({id:p.id,size:50,data:{colour:w(s)}})),{id:r,size:50,data:{name:u.name,colour:w(s)}}];a(x);const f=new Map;f.set(r,t),c.forEach(p=>{const j=i.similar.get(p.id);j&&f.set(p.id,j)});const h=A(f,!1,.3,4);d(h)},[i,u,r,s]),e.jsx(H,{links:n,nodes:m,linkScale:1.2,defaultLinkStyle:{opacity:t=>t.target.fx!==void 0?.6:.1,width:t=>oe+Math.floor(t.strength*se),colour:t=>t.target.fx!==void 0?F.secondary:"#444"},charge:.5,showLines:!0,zoom:.8,center:[0,0],disableControls:!0,disableCenter:!1,autoCamera:!0,children:m.map(t=>e.jsx(te,{id:t.id,node:t,onResize:()=>{}},t.id))})}const ne="_widgetColumn_1r491_1",ie="_bbcontainer_1r491_7",ae="_bbtick_1r491_14",b={widgetColumn:ne,bbcontainer:ie,bbtick:ae},ce=K(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M7 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"Pending");function le({spin:r}){return e.jsx(g,{dataWidget:"blackbox",children:e.jsxs("div",{className:b.bbcontainer,children:[e.jsx(E,{disabled:!r}),e.jsxs("div",{className:b.bbtick,children:[!r&&e.jsx(B,{color:"primary",fontSize:"large"}),r&&e.jsx(ce,{color:"disabled",fontSize:"large"})]})]})})}function de({id:r,onProfile:u,onRecommend:i,onLog:m,hideMenu:a}){const d=v().getUserName(r),s=l.useRef(null),{t:o}=C(),[t,c]=l.useState(!1),[x,f]=l.useState(!1),h=_(W);return e.jsxs(g,{title:d,dataWidget:"feed",style:{width:"400px",maxWidth:"80%"},contentStyle:{height:"600px"},noPadding:!0,menu:a?void 0:e.jsxs("div",{children:[e.jsx(Z,{ref:s,onClick:()=>c(!0),children:e.jsx(J,{})}),e.jsx(V,{anchorEl:s.current,open:t,onClose:()=>c(!1),children:e.jsx(X,{onClick:()=>{f(!0),c(!1)},children:o("workflow.actions.selectUser")})})]}),children:[e.jsx(Q,{open:x,onClose:()=>f(!1),onSelect:p=>h(p[0])}),e.jsx(q,{id:r,noHeader:!0,alwaysActive:!0,onProfile:u,onRecommend:i,onLog:m})]})}const me=[{start:"feed",end:"data",startPoint:"right",endPoint:"left"},{start:"feed",end:"blackbox",startPoint:"right",endPoint:"left"},{start:"blackbox",end:"recommendations",startPoint:"right",endPoint:"left"},{start:"data",end:"profile",startPoint:"right",endPoint:"left"},{start:"profile",end:"cluster",startPoint:"bottom",endPoint:"top"},{start:"profile",end:"recommendations",startPoint:"right",endPoint:"left"},{start:"cluster",end:"recommendations",startPoint:"right",endPoint:"left"}];function Re({id:r,onProfile:u,onRecommend:i,onLog:m,hideFeedMenu:a}){const{t:n}=C("common"),d=S(W),s=v(),o=r||d||s.getCurrentUser(),t=S(G(o||"user:")),[c,x]=l.useState(!1),f=l.useCallback(()=>{m&&m(),x(!0)},[m]);return l.useEffect(()=>{if(c){const h=setTimeout(()=>x(!1),1e3);return()=>{clearTimeout(h)}}},[c]),e.jsx(Y,{i18n:L,defaultNS:"common",children:e.jsxs(ee,{connections:me,children:[e.jsx(de,{id:o,onProfile:u,onRecommend:i,onLog:f,hideMenu:a}),t.blackboxWorkflow&&e.jsx(le,{spin:c}),!t.blackboxWorkflow&&e.jsx(g,{title:n("workflow.titles.data"),dataWidget:"data",style:{maxWidth:"350px"},contentStyle:{maxHeight:"600px"},noPadding:!0,children:e.jsx(I,{id:o,disableMenu:!0,noImageCloud:!0})}),!t.blackboxWorkflow&&e.jsxs("div",{"data-widget":"container",className:b.widgetColumn,children:[e.jsx(g,{title:n("workflow.titles.profile"),dataWidget:"profile",style:{maxWidth:"350px"},contentStyle:{maxHeight:"600px"},noPadding:!0,children:e.jsx(z,{id:o,disableMenu:!0,noTagSummary:!0})}),e.jsx(g,{title:n("workflow.titles.cluster"),dataWidget:"cluster",style:{maxWidth:"350px"},contentStyle:{maxHeight:"400px"},noPadding:!0,children:o&&e.jsx("div",{style:{position:"relative",width:"300px",height:"300px"},children:e.jsx(re,{userId:o})})})]}),e.jsx(g,{title:n("workflow.titles.map"),dataWidget:"recommendations",style:{width:"600px"},contentStyle:{height:"600px"},noPadding:!0,children:o&&e.jsx(T,{user:o,dimensions:20,deviationFactor:2})})]})})}export{Re as W};
