import{r as u,j as e,g as ee,a6 as se,c as M,l as ke,a0 as Pe,a2 as Me,v as Se,R as D,b as $,I as J}from"./index-ChHXuf40.js";import{I as Ie}from"./ImageSearch-B_1ksRDv.js";import{s as k,S as Q}from"./ScorePie-BXvYOECH.js";import{G as te}from"./Graph-BKYc9IKD.js";import{L as X}from"./Label-ByPLvDgY.js";import{c as S}from"./colours.module-BoWwueDy.js";import{u as Y,a as $e}from"./profiler-BgoGrxGa.js";import{l as ae}from"./localiser-C36yOspj.js";import{c as T,I as O}from"./IconButton-BXLcq7Mr.js";import{g as ie}from"./graphColours-CmwBa87t.js";import{c as V,a as P,u as U}from"./configState-BS87aI9Z.js";import{u as Te,g as De,a as ze}from"./Portal-BpkAKKpt.js";import{T as Ve,g as re,r as Ge}from"./useSlot-BVU38s2u.js";import{e as We}from"./createSimplePaletteValueFilter-CLdyqM5U.js";import{d as Oe}from"./debounce-Be36O1Ab.js";import{a as Ue,R as H}from"./RadioGroup-CQMSu_n2.js";import{C as He}from"./Close-Dh1l5TZE.js";import{I as Ae}from"./ImageGrid-Cx-mYdPF.js";import{R as Be}from"./Refresh-CxoqocOo.js";import{L as Fe}from"./LocalFireDepartment-G8EPqmTC.js";import{S as oe}from"./Spacer-Mn4BAxg4.js";import{I as B}from"./Item-BHRpsj3I.js";import{I as qe}from"./IconMenuInline-tbFKdX6Z.js";import{R as Ke}from"./RecommendationsHeatmap-CFho8frj.js";import{u as Xe}from"./recommender-Dk-Nrkxt.js";function Ye(t,a,n){const s=a.getBoundingClientRect(),r=n&&n.getBoundingClientRect(),l=ze(a);let i;if(a.fakeTransform)i=a.fakeTransform;else{const c=l.getComputedStyle(a);i=c.getPropertyValue("-webkit-transform")||c.getPropertyValue("transform")}let d=0,o=0;if(i&&i!=="none"&&typeof i=="string"){const c=i.split("(")[1].split(")")[0].split(",");d=parseInt(c[4],10),o=parseInt(c[5],10)}return t==="left"?r?`translateX(${r.right+d-s.left}px)`:`translateX(${l.innerWidth+d-s.left}px)`:t==="right"?r?`translateX(-${s.right-r.left-d}px)`:`translateX(-${s.left+s.width-d}px)`:t==="up"?r?`translateY(${r.bottom+o-s.top}px)`:`translateY(${l.innerHeight+o-s.top}px)`:r?`translateY(-${s.top-r.top+s.height-o}px)`:`translateY(-${s.top+s.height-o}px)`}function Ze(t){return typeof t=="function"?t():t}function F(t,a,n){const s=Ze(n),r=Ye(t,a,s);r&&(a.style.webkitTransform=r,a.style.transform=r)}const Je=u.forwardRef(function(a,n){const s=Te(),r={enter:s.transitions.easing.easeOut,exit:s.transitions.easing.sharp},l={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen},{addEndListener:i,appear:d=!0,children:o,container:c,direction:m="down",easing:p=r,in:b,onEnter:w,onEntered:v,onEntering:g,onExit:_,onExited:j,onExiting:h,style:C,timeout:I=l,TransitionComponent:y=Ve,...G}=a,R=u.useRef(null),Z=We(De(o),R,n),f=x=>L=>{x&&(L===void 0?x(R.current):x(R.current,L))},N=f((x,L)=>{F(m,x,c),Ge(x),w&&w(x,L)}),_e=f((x,L)=>{const A=re({timeout:I,style:C,easing:p},{mode:"enter"});x.style.webkitTransition=s.transitions.create("-webkit-transform",{...A}),x.style.transition=s.transitions.create("transform",{...A}),x.style.webkitTransform="none",x.style.transform="none",g&&g(x,L)}),ye=f(v),Ee=f(h),Ne=f(x=>{const L=re({timeout:I,style:C,easing:p},{mode:"exit"});x.style.webkitTransition=s.transitions.create("-webkit-transform",L),x.style.transition=s.transitions.create("transform",L),F(m,x,c),_&&_(x)}),Le=f(x=>{x.style.webkitTransition="",x.style.transition="",j&&j(x)}),Re=x=>{i&&i(R.current,x)},ne=u.useCallback(()=>{R.current&&F(m,R.current,c)},[m,c]);return u.useEffect(()=>{if(b||m==="down"||m==="right")return;const x=Oe(()=>{R.current&&F(m,R.current,c)}),L=ze(R.current);return L.addEventListener("resize",x),()=>{x.clear(),L.removeEventListener("resize",x)}},[m,b,c]),u.useEffect(()=>{b||ne()},[b,ne]),e.jsx(y,{nodeRef:R,onEnter:N,onEntered:ye,onEntering:_e,onExit:Ne,onExited:Le,onExiting:Ee,addEndListener:Re,appear:d,in:b,timeout:I,...G,children:(x,{ownerState:L,...A})=>u.cloneElement(o,{ref:Z,style:{visibility:x==="exited"&&!b?"hidden":void 0,...C,...o.props.style},...A})})}),Qe="_container_1lljw_3",et="_outerContainer_1lljw_14",tt="_infoBar_1lljw_54",q={container:Qe,outerContainer:et,infoBar:tt},ce={},le=5,nt=u.memo(function({disabled:a,node:n}){var d,o,c,m,p;const s=ee(),r=n.size,l=((d=n.data)==null?void 0:d.image)||"",i=(o=n.data)==null?void 0:o.name;return e.jsxs("g",{className:a?ce.disabledGroup:ce.group,children:[e.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r,fill:l.length>0?"white":((c=n.data)==null?void 0:c.colour)||"#5f7377",stroke:((m=n.data)==null?void 0:m.colour)||"#5f7377",strokeWidth:le}),l.length>0&&e.jsx("image",{x:-r,y:-r,width:r*2,height:r*2,href:s.getContentData(l,!0),preserveAspectRatio:"none",clipPath:`circle(${r-le}px)`}),i&&e.jsx(X,{label:i,x:0,y:r+30,scale:i.length<20?2.5:2,padding:5,fill:((p=n.data)==null?void 0:p.colour)||"#5f7377",color:"white"})]})}),st=20,at=5;function it({userId:t,pairedId:a,contentId:n}){const s=Y(t),r=Y(a),l=$e(s),[i,d]=u.useState([]),[o,c]=u.useState([]);return u.useEffect(()=>{const m=l.reduce((h,C)=>Math.min(h,C.weight),1),b=l.reduce((h,C)=>Math.max(h,C.weight),0)-m,w=r.affinities.contents.contents.reduce((h,C)=>Math.min(h,C.weight),1),g=r.affinities.contents.contents.reduce((h,C)=>Math.max(h,C.weight),0)-w,_=[...l.filter(h=>h.id!==a).map(h=>({id:h.id,size:30,data:{colour:S.backgroundDark}})),...r.affinities.contents.contents.filter(h=>h.id!==n).map(h=>({id:h.id,size:40,data:{image:h.id,colour:S.primary}})),{id:t,size:30,fx:-300,fy:-100,data:{name:s.name,colour:S.secondary}},{id:a,size:30,fx:-50,fy:0,data:{name:r.name,colour:S.secondary}},{id:n,size:80,fx:220,fy:100,data:{image:n,colour:S.secondary}}];d(_);const j=[...l.map(h=>({source:t,target:h.id,strength:(h.weight-m)/b,actualStrength:h.weight})),...r.affinities.contents.contents.map(h=>({source:a,target:h.id,strength:(h.weight-w)/g,actualStrength:h.weight}))];c(j)},[l,s,t,a,r,n]),e.jsx(te,{links:o,nodes:i,linkScale:1,defaultLinkStyle:{opacity:m=>m.target.fx!==void 0?.6:.1,width:m=>at+Math.floor(m.strength*st),colour:m=>m.target.fx!==void 0?S.secondary:"#444"},charge:.3,showLines:!0,zoom:1,center:[0,0],disableControls:!0,disableCenter:!0,children:i.map(m=>e.jsx(nt,{id:m.id,node:m,onResize:()=>{}},m.id))})}const de={},me=5,rt=u.memo(function({disabled:a,node:n,id:s,onResize:r}){var c,m,p,b,w,v,g;const l=ee(),i=n.size,d=((c=n.data)==null?void 0:c.image)||"",o=(m=n.data)==null?void 0:m.name;return e.jsxs("g",{className:a?de.disabledGroup:de.group,children:[!se(s)&&e.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r:i,fill:d.length>0?"white":((p=n.data)==null?void 0:p.colour)||"#5f7377",stroke:((b=n.data)==null?void 0:b.colour)||"#5f7377",strokeWidth:me}),d.length>0&&e.jsx("image",{x:-i,y:-i,width:i*2,height:i*2,href:l.getContentData(d,!0),preserveAspectRatio:"none",clipPath:`circle(${i-me}px)`}),o&&e.jsx(X,{label:o,x:0,y:i+30,scale:o.length<20?2.5:2,padding:5,fill:((w=n.data)==null?void 0:w.colour)||"#5f7377",color:"white"}),se(s)&&e.jsx(X,{label:((v=n.data)==null?void 0:v.label)||"NoLabel",x:0,y:0,scale:2.5,padding:5,fill:((g=n.data)==null?void 0:g.colour)||"#5f7377",color:"white",onResize:_=>r(s,Math.ceil(_))})]})}),ot=20,ct=5,K=.1;function lt({userId:t,topic:a,contentId:n}){const{i18n:s}=M(),r=Y(t),[l,i]=u.useReducer(g=>g+1,0),[d,o]=u.useState([]),[c,m]=u.useState([]),p=u.useRef(new Map),{graph:b,content:w}=ke(),v=u.useCallback((g,_)=>{const j=p.current.get(g);p.current.set(g,_),j!==_&&i()},[]);return u.useEffect(()=>{const g=r.affinities.topics.topics.slice(0,5),_=g.reduce((f,N)=>Math.min(f,N.weight),1e3),h=g.reduce((f,N)=>Math.max(f,N.weight),0)-_,C=b.getRelated("content",Pe(b,a)).map(f=>{var N;return{id:f.id,weight:((N=w.getContentStats(f.id))==null?void 0:N.engagement)||0}});C.sort((f,N)=>N.weight-f.weight),C.splice(5);const I=C.reduce((f,N)=>Math.min(f,N.weight),1),G=C.reduce((f,N)=>Math.max(f,N.weight),0)-I,R=[...g.filter(f=>f.label!==a).map(f=>({id:`topic:${f.label}`,size:p.current.get(`topic:${f.label}`)||30,data:{colour:S.backgroundDark,label:`#${ae.getLocalisedLabel(f.label,s.language)}`}})),...C.filter(f=>f.id!==n).map(f=>({id:f.id,size:30,data:{colour:S.backgroundDark,image:f.id}})),{id:t,size:30,fx:-180,fy:100,data:{name:r.name,colour:S.secondary}},{id:`topic:${a}`,size:p.current.get(`topic:${a}`)||30,fx:20,fy:0,data:{label:`#${ae.getLocalisedLabel(a,s.language)}`,colour:S.secondary}},{id:n,size:80,fx:280,fy:-150,data:{image:n,colour:S.secondary}}];o(R);const Z=[...g.filter(f=>f.label!==a).map(f=>({source:t,target:`topic:${f.label}`,strength:(f.weight-_)/h*K+(1-K),actualStrength:f.weight})),{source:`topic:${a}`,target:n,strength:.5,actualStrength:.5},{target:`topic:${a}`,source:t,strength:.5,actualStrength:.5},...C.filter(f=>f.id!==n).map(f=>({source:`topic:${a}`,target:f.id,strength:G>0?(f.weight-I)/G*K+(1-K):.5,actualStrength:f.weight||.5}))];m(Z)},[r,t,n,a,l,w,b,s]),e.jsx(te,{links:c,nodes:d,linkScale:10,defaultLinkStyle:{opacity:g=>g.target.fx!==void 0?.6:.1,width:g=>ct+Math.floor(g.strength*ot),colour:g=>g.target.fx!==void 0?S.secondary:"#444"},charge:.1,showLines:!0,zoom:1,center:[0,0],disableControls:!0,disableCenter:!1,children:d.map(g=>e.jsx(rt,{id:g.id,node:g,onResize:v},g.id))})}const ue={},fe=5,dt=u.memo(function({disabled:a,node:n}){var d,o,c,m,p;const s=ee(),r=n.size,l=((d=n.data)==null?void 0:d.image)||"",i=(o=n.data)==null?void 0:o.name;return e.jsxs("g",{className:a?ue.disabledGroup:ue.group,children:[e.jsx("circle",{"data-nodeitem":!0,"data-testid":"profile-circle",r,fill:(l.length>0?"white":(c=n.data)==null?void 0:c.colour)||"#5f7377",stroke:((m=n.data)==null?void 0:m.colour)||"#5f7377",strokeWidth:fe}),l.length>0&&e.jsx("image",{x:-r,y:-r,width:r*2,height:r*2,href:s.getContentData(l,!0),preserveAspectRatio:"none",clipPath:`circle(${r-fe}px)`}),i&&e.jsx(X,{label:i,x:0,y:r+30,scale:i.length<20?2.5:2,padding:5,fill:((p=n.data)==null?void 0:p.colour)||"#5f7377",color:"white"})]})}),mt=20,ut=5;function ft({userId:t,originId:a,contentId:n}){const s=Y(t),[r,l]=u.useState([]),[i,d]=u.useState([]),o=Me();return u.useEffect(()=>{const c=o.getRelated("coengaged",a,{count:8}),m=o.getEdgeWeights("engaged",t,a)[0]||0,p=o.getEdgeWeights("coengaged",a,n)[0]||0,b=c.reduce((j,h)=>Math.min(j,h.weight),Math.min(m,p)),v=c.reduce((j,h)=>Math.max(j,h.weight),Math.max(m,p))-b,g=[...c.filter(j=>j.id!==n).map(j=>({id:j.id,size:40,data:{colour:S.backgroundDark,image:j.id}})),{id:t,size:30,fx:-300,fy:-100,data:{name:s.name,colour:S.secondary}},{id:a,size:80,fx:-50,fy:0,data:{image:a,colour:S.secondary}},{id:n,size:80,fx:220,fy:100,data:{image:n,colour:S.secondary}}];l(g);const _=[...c.filter(j=>j.id!==n).map(j=>({source:a,target:j.id,strength:(j.weight-b)/v,actualStrength:j.weight})),{source:t,target:a,strength:(m-b)/v,actualStrength:m},{source:a,target:n,strength:(p-b)/v,actualStrength:p}];d(_)},[a,n,t,s,o]),e.jsx(te,{links:i,nodes:r,linkScale:1,defaultLinkStyle:{opacity:c=>c.target.fx!==void 0?.6:.1,width:c=>ut+Math.floor(c.strength*mt),colour:c=>c.target.fx!==void 0?S.secondary:"#444"},charge:.3,showLines:!0,zoom:1,center:[0,0],disableControls:!0,disableCenter:!0,children:r.map(c=>e.jsx(dt,{id:c.id,node:c,onResize:()=>{}},c.id))})}function gt(t,a,n){var r;let s;switch(a.candidateOrigin){case"topic_affinity":s=n("recommendations.labels.topicCandidate",{topic:a.topic||""});break;case"random":s=n("recommendations.labels.random");break;case"popular":s=n("recommendations.labels.popularCandidate");break;case"coengagement":s=n("recommendations.labels.coengagedCandidate");break;case"similar_user":s=n("recommendations.labels.similarUserCandidate",{userName:a.similarUser&&((r=t.getUserData(a.similarUser))==null?void 0:r.name)||""});break;default:s=""}return s}function ht({item:t,userId:a}){const{t:n}=M(),s=Se();return e.jsxs("li",{"data-testid":"candidate-item",children:[e.jsxs("div",{className:k.listIcon,children:[e.jsx(Ie,{fontSize:"large"}),e.jsx("h2",{children:n("recommendations.titles.candidateOrigin")})]}),e.jsxs("div",{className:k.listColumn,children:[gt(s,t,n),t.candidateOrigin==="similar_user"&&e.jsx("div",{className:k.miniGraphBox,children:e.jsx(it,{userId:a,pairedId:t.similarUser||"user:none",contentId:t.contentId})}),t.candidateOrigin==="topic_affinity"&&e.jsx("div",{className:k.miniGraphBox,children:e.jsx(lt,{userId:a,topic:t.topic||"",contentId:t.contentId})}),t.candidateOrigin==="coengagement"&&e.jsx("div",{className:k.miniGraphBox,children:e.jsx(ft,{userId:a,originId:t.engagedItem||"content:x",contentId:t.contentId})})]})]})}const pt=T(e.jsx("path",{d:"M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2M5 8V7h2v3.82C5.84 10.4 5 9.3 5 8m14 0c0 1.3-.84 2.4-2 2.82V7h2z"}),"EmojiEvents");function xt({item:t}){const{t:a}=M();return e.jsxs("li",{"data-testid":"score-item",children:[e.jsxs("div",{className:k.listIcon,children:[e.jsx(pt,{fontSize:"large"}),e.jsx("h2",{children:a("recommendations.titles.predictedScore")})]}),e.jsx("div",{className:k.listColumn,style:{alignItems:"center"},children:e.jsxs("div",{className:k.scoreList,children:[e.jsx(Q,{value:t.score||0,maxValue:1,label:a("recommendations.labels.score"),showValue:!0,color:S.secondary,size:100,bgColor:S.bgSubdued1}),e.jsx(Q,{value:t.diversity||0,maxValue:1,label:a("recommendations.labels.diversity"),showValue:!0,color:S.primary,size:70,bgColor:S.bgSubdued1})]})})]})}const bt=T(e.jsx("path",{d:"M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7"}),"Lightbulb"),ge=20,he=60;function wt({item:t}){const{t:a}=M(),n=Object.keys(t.scores),s=n.map(o=>t.significance[o]||0),r=Math.max(...s),l=Math.min(...s),i=r-l,d=n.map(o=>({name:o,score:t.features[o]||0,significance:i>0?((t.significance[o]||0)-l)/i:t.significance[o]||0})).filter(o=>o.score>0&&o.significance>0);return d.sort((o,c)=>c.significance-o.significance),e.jsxs("li",{"data-testid":"explain-item",children:[e.jsxs("div",{className:k.listIcon,children:[e.jsx(bt,{fontSize:"large"}),e.jsx("h2",{children:a("recommendations.titles.explainScore")})]}),e.jsx("div",{className:k.listColumn,children:d.map((o,c)=>o.score>0?e.jsxs("div",{className:k.scoreRow,children:[e.jsx(Q,{value:o.score||0,maxValue:1,showValue:!0,color:ie[c%ie.length],bgColor:S.bgSubdued1,size:i>0?o.significance*ge+he:he+ge/2}),e.jsx("div",{children:a(`recommendations.features.${o.name}`)})]},o.name):null)})]})}function jt({userId:t,recommendation:a,hideExplain:n,hideCandidate:s,hideScores:r}){return e.jsx("div",{children:e.jsxs("ul",{className:k.tableList,children:[!s&&e.jsx(ht,{item:a,userId:t}),!r&&e.jsx(xt,{item:a}),!n&&e.jsx(wt,{item:a})]})})}const St="_wizard_yzri2_3",zt="_wizardClosed_yzri2_13 _wizard_yzri2_3",Ct="_plainwizard_yzri2_21 _wizard_yzri2_3",vt="_plainwizardClosed_yzri2_27 _plainwizard_yzri2_21 _wizard_yzri2_3",_t="_wizardStartPage_yzri2_39",yt="_wizardPage_yzri2_43",Et="_wizardControls_yzri2_51",Nt="_wizardLabelContainer_yzri2_71",Lt="_wizardLabelDisabled_yzri2_81 _wizardLabelContainer_yzri2_71",Rt="_wizardLabel_yzri2_71",kt="_wizardLabelSelect_yzri2_91 _wizardLabel_yzri2_71",Pt="_wizardLabelDesc_yzri2_96",Mt="_wizardLabelGroup_yzri2_100",z={wizard:St,wizardClosed:zt,plainwizard:Ct,plainwizardClosed:vt,wizardStartPage:_t,wizardPage:yt,wizardControls:Et,wizardLabelContainer:Nt,wizardLabelDisabled:Lt,wizardLabel:Rt,wizardLabelSelect:kt,wizardLabelDesc:Pt,wizardLabelGroup:Mt},It="_container_1bj1q_3",$t="_page_1bj1q_9",Tt="_slideControls_1bj1q_15",Dt="_stepper_1bj1q_21",Vt="_activeStep_1bj1q_35 _step_1bj1q_21",Gt="_inactiveStep_1bj1q_40 _step_1bj1q_21",W={container:It,page:$t,slideControls:Tt,stepper:Dt,activeStep:Vt,inactiveStep:Gt};function Wt(t,a,n){let s="left";return t===n?n<a?s="right":s="left":n<a?s="left":s="right",s}function Ot({page:t,children:a,onHeight:n,controls:s}){const r=u.useRef(-1),[l,i]=u.useState(-1),d=u.useRef(null),o=u.useRef(null);return u.useEffect(()=>{const c=t;return i(t),()=>{r.current=c}},[t]),e.jsxs("div",{ref:d,className:W.container,children:[Array.isArray(a)?a.map((c,m)=>e.jsx(Je,{direction:Wt(m,t,r.current),in:l===m,mountOnEnter:!0,unmountOnExit:!0,container:d.current,onEnter:p=>{var b;n&&n(p.clientHeight+(((b=o.current)==null?void 0:b.clientHeight)||0))},children:e.jsx("div",{className:W.page,children:c})},m)):a,s&&e.jsx("div",{className:W.slideControls,ref:o,children:s})]})}function Ce(t){return t.taste>0||t.coengaged>0||t.similarUsers>0}function ve(t){return t.random>0||t.popular>0}function Ut(t){return!ve(t)&&Ce(t)}function Ht(t){return ve(t)&&!Ce(t)}function At(t){return Ut(t)?"personal":Ht(t)?"nonpersonal":"both"}function Bt(t){return!t.noTasteScore||!t.noCoengagementScore||!t.noSharingScore||!t.noCommentingScore||!t.noFollowingScore||!t.noViewingScore||!t.noReactionScore}function Ft(t){return Bt(t)?t!=null&&t.noPopularity?"profile":"all":t!=null&&t.noPopularity?"random":"noprofile"}function E({label:t,description:a,value:n,color:s,disabled:r,selected:l}){return e.jsxs("label",{className:r?z.wizardLabelDisabled:z.wizardLabelContainer,style:{borderColor:s||void 0},children:[e.jsx(Ue,{value:n,disabled:r,inputProps:{"data-testid":`${n}-option`}}),e.jsxs("div",{className:z.wizardLabelGroup,children:[e.jsx("span",{className:l?z.wizardLabelSelect:z.wizardLabel,children:t}),e.jsx("span",{className:z.wizardLabelDesc,children:a})]})]})}const pe={both:{random:2,similarUsers:2,taste:2,coengaged:2,popular:2},personal:{random:0,similarUsers:2,taste:2,coengaged:2,popular:0},nonpersonal:{random:2,similarUsers:0,taste:0,coengaged:0,popular:2}};function qt({id:t,changePage:a}){const{t:n}=M(),s=D(t?V(t):P),r=$(U(t||"user:none")),l=$(P),i=At(s.recommendations);return u.useEffect(()=>{s.showCandidateRefinementWizard?i==="personal"?a(2):i==="nonpersonal"?a(3):s.showScoringWizard?a(4):s.showDiversityWizard?a(5):a(0):s.showScoringWizard?a(4):s.showDiversityWizard?a(5):a(0)},[i,a,s]),e.jsxs("section",{className:z.wizardPage,"data-testid":"recom-candidate-options",children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.candidateDiscovery")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(H,{sx:{gap:"0.5rem"},"aria-label":"",defaultValue:"both",name:"radio-buttons-group",value:i,onChange:(d,o)=>{t?r({recommendations:{...s.recommendations,...pe[o]}}):l(c=>({...c,recommendations:{...c.recommendations,...pe[o]}}))},children:[e.jsx(E,{selected:i==="personal",value:"personal",label:n("recommendations.labels.candidatePersonal"),description:n("recommendations.descriptions.candidatePersonal")}),e.jsx(E,{selected:i==="nonpersonal",value:"nonpersonal",label:n("recommendations.labels.candidateNonPersonal"),description:n("recommendations.descriptions.candidateNonPersonal")}),e.jsx(E,{selected:i==="both",value:"both",label:n("recommendations.labels.candidatePersonalAndNon"),description:n("recommendations.descriptions.candidatePersonalAndNon")})]})})]})}const xe={noprofile:{noTasteScore:!0,noSharingScore:!0,noFollowingScore:!0,noReactionScore:!0,noViewingScore:!0,noCoengagementScore:!0,noCommentingScore:!0,noPopularity:!1},profile:{noTasteScore:!1,noSharingScore:!1,noFollowingScore:!1,noReactionScore:!1,noViewingScore:!1,noCoengagementScore:!1,noCommentingScore:!1,noPopularity:!0},random:{noTasteScore:!0,noSharingScore:!0,noFollowingScore:!0,noReactionScore:!0,noViewingScore:!0,noCoengagementScore:!0,noCommentingScore:!0,noPopularity:!0},all:{noTasteScore:!1,noSharingScore:!1,noFollowingScore:!1,noReactionScore:!1,noViewingScore:!1,noCoengagementScore:!1,noCommentingScore:!1,noPopularity:!1}};function Kt({id:t,changePage:a}){const{t:n}=M(),s=D(t?V(t):P),r=$(U(t||"user:none")),l=$(P),i=Ft(s.recommendations);return u.useEffect(()=>{s.showDiversityWizard?a(5):a(0)},[s,i,a]),e.jsxs("section",{className:z.wizardPage,children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.scoringOptions")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(H,{sx:{gap:"0.5rem"},"aria-label":"",defaultValue:"both",name:"radio-buttons-group",value:i,onChange:(d,o)=>{t?r({recommendations:{...s.recommendations,...xe[o]}}):l(c=>({...c,recommendations:{...c.recommendations,...xe[o]}}))},children:[e.jsx(E,{selected:i==="profile",value:"profile",label:n("recommendations.labels.scoringPredict"),description:n("recommendations.descriptions.scoringPredict")}),e.jsx(E,{selected:i==="noprofile",value:"noprofile",label:n("recommendations.labels.scoringGeneral"),description:n("recommendations.descriptions.scoringGeneral")}),e.jsx(E,{selected:i==="random",value:"random",label:n("recommendations.labels.scoringRandom"),description:n("recommendations.descriptions.scoringRandom")}),e.jsx(E,{selected:i==="all",value:"all",label:n("recommendations.labels.scoringAll"),description:n("recommendations.descriptions.scoringAll")})]})})]})}const be={all:{random:0,similarUsers:2,taste:2,coengaged:2,popular:0},taste:{random:0,similarUsers:0,taste:4,coengaged:0,popular:0},users:{random:0,similarUsers:4,taste:0,coengaged:0,popular:0},coengaged:{random:0,similarUsers:0,taste:0,coengaged:4,popular:0}};function Xt(t){return t.taste>0&&t.coengaged>0&&t.similarUsers>0?"all":t.taste>0?"taste":t.similarUsers>0?"users":t.coengaged>0?"coengaged":"all"}function Yt({id:t,changePage:a}){const{t:n}=M(),s=D(t?V(t):P),r=$(U(t||"user:none")),l=$(P);return u.useEffect(()=>{s.showScoringWizard?a(4):s.showDiversityWizard?a(5):a(0)},[s,a]),e.jsxs("section",{className:z.wizardPage,children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.candidatesPersonal")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(H,{"aria-label":"",sx:{gap:"0.5rem"},defaultValue:"image",name:"radio-buttons-group",value:Xt(s.recommendations),onChange:(i,d)=>{t?r({recommendations:{...s.recommendations,...be[d]}}):l(o=>({...o,recommendations:{...o.recommendations,...be[d]}}))},children:[e.jsx(E,{value:"taste",label:n("recommendations.labels.candidateLabels"),description:n("recommendations.descriptions.candidateLabels")}),e.jsx(E,{value:"users",label:n("recommendations.labels.candidateUsers"),description:n("recommendations.descriptions.candidateUsers")}),e.jsx(E,{value:"coengaged",label:n("recommendations.labels.candidateCoengaged"),description:n("recommendations.descriptions.candidateCoengaged")}),e.jsx(E,{value:"all",label:n("recommendations.labels.candidateAll")})]})})]})}const we={all:{random:2,similarUsers:0,taste:0,coengaged:0,popular:2},random:{random:4,similarUsers:0,taste:0,coengaged:0,popular:0},popular:{random:0,similarUsers:0,taste:0,coengaged:0,popular:2}};function Zt(t){return t.random>0&&t.popular>0?"all":t.popular>0?"popular":t.random>0?"random":"all"}function Jt({id:t,changePage:a}){const{t:n}=M(),s=D(t?V(t):P),r=$(U(t||"user:none")),l=$(P);return u.useEffect(()=>{s.showScoringWizard?a(4):s.showDiversityWizard?a(5):a(0)},[s,a]),e.jsxs("section",{className:z.wizardPage,children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.candidatesNonPersonal")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(H,{"aria-label":"",defaultValue:"image",sx:{gap:"0.5rem"},name:"radio-buttons-group",value:Zt(s.recommendations),onChange:(i,d)=>{t?r({recommendations:{...s.recommendations,...we[d]}}):l(o=>({...o,recommendations:{...o.recommendations,...we[d]}}))},children:[e.jsx(E,{value:"random",label:n("recommendations.labels.candidateRandom"),description:n("recommendations.descriptions.candidateRandom")}),e.jsx(E,{value:"popular",label:n("recommendations.labels.candidatePopular"),description:n("recommendations.descriptions.candidatePopular")}),e.jsx(E,{value:"all",label:n("recommendations.labels.candidateAll")})]})})]})}const Qt=T(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos"),en=T(e.jsx("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"}),"ArrowBackIosNew");function tn({steps:t,page:a}){const s=u.useMemo(()=>{const r=new Map;return t&&t.forEach((l,i)=>{l.forEach(d=>{r.set(d,i)})}),r},[t]).get(a)||0;return e.jsx("div",{className:W.stepper,children:Array.from({length:t.length},(r,l)=>e.jsx("div",{className:l===s?W.activeStep:W.inactiveStep},l))})}const nn=T(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel");function sn({id:t,changePage:a}){const{t:n}=M(),s=D(t?V(t):P),r=$(U(t||"user:none")),l=$(P),i=s.recommendations.selection;return u.useEffect(()=>{a(0)},[i,a]),e.jsxs("section",{className:z.wizardPage,children:[e.jsx("header",{children:e.jsx("h2",{children:n("recommendations.titles.diversityOptions")})}),e.jsx("div",{className:z.buttonList,children:e.jsxs(H,{sx:{gap:"0.5rem"},"aria-label":"",defaultValue:"both",name:"radio-buttons-group",value:i||"distribution",onChange:(d,o)=>{t?r({recommendations:{...s.recommendations,selection:o}}):l(c=>({...c,recommendations:{...c.recommendations,selection:o}}))},children:[e.jsx(E,{selected:i==="distribution",value:"distribution",label:n("recommendations.labels.selectionProbability"),description:n("recommendations.descriptions.selectionProbability")}),e.jsx(E,{selected:i==="rank",value:"rank",label:n("recommendations.labels.selectionRank"),description:n("recommendations.descriptions.selectionRank")})]})})]})}function an({id:t,active:a,onClose:n,hideClose:s,variant:r="styled"}){const{t:l}=M(),[i,d]=u.useState(0),[o,c]=u.useState(0),[m,p]=u.useState(1),b=u.useRef([0]),w=D(t?V(t):P);u.useEffect(()=>{a&&(w.showCandidateWizard?d(1):w.showScoringWizard?d(4):w.showDiversityWizard?d(5):d(1))},[a]);const v=g=>{g>i&&b.current.push(i),d(g),g===0&&n()};return e.jsxs("section",{className:r==="styled"?a?z.wizard:z.wizardClosed:a?z.plainwizard:z.plainwizardClosed,style:{height:`${o}px`},"data-testid":"recom-wizard",children:[e.jsxs(Ot,{page:i,onHeight:c,controls:i>0?e.jsxs("div",{className:z.wizardControls,children:[e.jsx(J,{variant:"outlined",disabled:i<=1,color:"inherit",onClick:()=>v(b.current.pop()||0),startIcon:e.jsx(en,{}),children:l("recommendations.actions.back")}),e.jsx(tn,{steps:[[0,1],w.showCandidateRefinementWizard?[2,3]:void 0,w.showScoringWizard?[4]:void 0,w.showDiversityWizard?[5]:void 0].filter(g=>g!==void 0),page:i}),e.jsx(J,{color:"primary",variant:"contained",onClick:()=>v(m),endIcon:m===0?e.jsx(He,{}):e.jsx(Qt,{}),disabled:m<0,"aria-live":"off",children:l(m===0?"recommendations.actions.close":"recommendations.actions.continue")})]}):null,children:[e.jsx("div",{className:z.wizardStartPage}),e.jsx(qt,{id:t,changePage:p}),e.jsx(Yt,{id:t,changePage:p}),e.jsx(Jt,{id:t,changePage:p}),e.jsx(Kt,{id:t,changePage:p}),e.jsx(sn,{id:t,changePage:p})]}),i>0&&!s&&e.jsx(O,{sx:{position:"absolute",top:"5px",right:"5px"},size:"small",onClick:()=>v(0),"aria-label":l("recommendations.actions.close"),children:e.jsx(nn,{htmlColor:"#444",fontSize:"medium"})})]})}const je=T(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),rn=T(e.jsx("path",{d:"m16.24 11.51 1.57-1.57-3.75-3.75-1.57 1.57-4.14-4.13c-.78-.78-2.05-.78-2.83 0l-1.9 1.9c-.78.78-.78 2.05 0 2.83l4.13 4.13L3 17.25V21h3.75l4.76-4.76 4.13 4.13c.95.95 2.23.6 2.83 0l1.9-1.9c.78-.78.78-2.05 0-2.83zm-7.06-.44L5.04 6.94l1.89-1.9L8.2 6.31 7.02 7.5l1.41 1.41 1.19-1.19 1.45 1.45zm7.88 7.89-4.13-4.13 1.9-1.9 1.45 1.45-1.19 1.19 1.41 1.41 1.19-1.19 1.27 1.27zm3.65-11.92c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.47-.47-1.12-.29-1.41 0l-1.83 1.83 3.75 3.75z"}),"DesignServices"),on=T(e.jsx("path",{d:"M4 8h4V4H4zm6 12h4v-4h-4zm-6 0h4v-4H4zm0-6h4v-4H4zm6 0h4v-4h-4zm6-10v4h4V4zm-6 4h4V4h-4zm6 6h4v-4h-4zm0 6h4v-4h-4z"}),"Apps"),cn=T(e.jsx("path",{d:"M12 4.81V19c-3.31 0-6-2.63-6-5.87 0-1.56.62-3.03 1.75-4.14zM6.35 7.56C4.9 8.99 4 10.96 4 13.13 4 17.48 7.58 21 12 21s8-3.52 8-7.87c0-2.17-.9-4.14-2.35-5.57L12 2z"}),"InvertColors");function In({id:t,generate:a,noWizard:n}){const{t:s}=M(),r=Se(),l=t||r.getCurrentUser(),i=D(V(l)),{recommendations:d,more:o}=Xe(9,t,i==null?void 0:i.recommendations),[c,m]=u.useState(),[p,b]=u.useState(!1),[w,v]=u.useState("grid"),[g,_]=u.useReducer(y=>y+1,0),[j,h]=u.useState(!1),C=d.map(y=>({id:y.contentId,weight:Math.max(y.score,.01)}));u.useEffect(()=>{a&&o()},[a,o]);const I=c&&d.find(y=>y.contentId===c);return e.jsx("div",{className:q.outerContainer,children:e.jsxs("div",{className:q.container,tabIndex:0,children:[i.showRecommendationWizard&&!n&&e.jsx(an,{active:p,onClose:()=>b(!1),id:l}),!i.hideRecommendationMenu&&e.jsxs(qe,{children:[i.showRecommendationWizard&&!n&&e.jsxs(e.Fragment,{children:[e.jsx(J,{onClick:()=>b(!0),variant:"contained",color:"secondary",startIcon:e.jsx(rn,{}),"data-testid":"start-recom-wizard",sx:{marginLeft:"1rem"},disabled:p,children:s("recommendations.actions.change")}),e.jsx("div",{style:{flexGrow:1}}),e.jsx(oe,{})]}),e.jsx(B,{tooltip:s("recommendations.labels.imageGrid"),selected:w==="grid",children:e.jsx(O,{color:"inherit",onClick:()=>v("grid"),"aria-label":s("recommendations.aria.imageGrid"),children:e.jsx(on,{})})}),e.jsx(B,{tooltip:s("recommendations.labels.heatmap"),selected:w==="heat",children:e.jsx(O,{color:"inherit",onClick:()=>v("heat"),"aria-label":s("recommendations.aria.heatmap"),"data-testid":"heatmap-button",children:e.jsx(Fe,{})})}),e.jsx(oe,{}),e.jsx(B,{tooltip:s("recommendations.actions.invert"),selected:j,children:e.jsx(O,{color:"inherit",disabled:w!=="heat",onClick:()=>{w==="heat"&&h(y=>!y)},"aria-label":s("recommendations.aria.invert"),children:e.jsx(cn,{})})}),e.jsx(B,{tooltip:s("recommendations.actions.refresh"),children:e.jsx(O,{color:"inherit",onClick:()=>{w==="grid"?o():_()},"aria-label":s("recommendations.aria.refresh"),children:e.jsx(Be,{})})})]}),w==="heat"&&e.jsxs(e.Fragment,{children:[e.jsx(Ke,{user:l,dimensions:25,invert:j},`heat-${g}`),e.jsxs("div",{className:q.infoBar,children:[e.jsx(je,{}),e.jsx("span",{children:s("recommendations.descriptions.heatHint")})]})]}),w==="grid"&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{selected:c,onSelect:y=>m(G=>G===y?void 0:y),images:C.map(y=>y.id)}),!I&&e.jsxs("div",{className:q.infoBar,children:[e.jsx(je,{}),e.jsx("span",{children:s("recommendations.descriptions.selectHint")})]}),I&&e.jsx(jt,{userId:l,recommendation:I,hideCandidate:i.hideCandidateOrigin,hideExplain:i.hideExplainedScores})]}),e.jsx("div",{style:{flexGrow:5,flexShrink:1}})]})})}export{on as A,In as R,an as a};
